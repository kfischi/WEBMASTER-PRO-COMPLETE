<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMaster Pro - אדיטור מתקדם עם כלי עיצוב וענן</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Assistant:wght@300;400;500;600;700;800;900&family=Heebo:wght@300;400;500;600;700;800;900&family=Rubik:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --accent: #f093fb;
            --success: #26de81;
            --warning: #fed330;
            --danger: #f5576c;
            --dark: #0a0a0a;
            --dark-light: #1a1a2e;
            --dark-lighter: #2d2d4a;
            --light: #ffffff;
            --gray: #8b8b8b;
            --gray-light: #f5f5f5;
            
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #26de81 0%, #4ade80 100%);
            --gradient-danger: linear-gradient(135deg, #f5576c 0%, #ef4444 100%);
            --gradient-glass: rgba(255, 255, 255, 0.1);
            
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.1);
            --shadow-medium: 0 8px 40px rgba(0, 0, 0, 0.15);
            --shadow-heavy: 0 20px 80px rgba(0, 0, 0, 0.25);
            
            --border-radius: 16px;
            --border-radius-small: 8px;
            --border-radius-large: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Assistant', 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #2d2d4a 100%);
            color: var(--light);
            overflow: hidden;
            height: 100vh;
        }

        /* Main Layout */
        .editor-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Left Sidebar - Enhanced */
        .left-sidebar {
            width: 380px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            z-index: 1000;
        }

        .sidebar-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: var(--gradient-primary);
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        .tab-navigation {
            display: flex;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            padding: 15px 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            border-bottom: 3px solid transparent;
        }

        .tab-btn.active {
            color: white;
            background: rgba(255, 255, 255, 0.1);
            border-bottom-color: var(--primary);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-content {
            display: none;
            padding: 25px;
        }

        .tab-content.active {
            display: block;
        }

        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            color: rgba(255, 255, 255, 0.9);
        }

        .form-input, .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-small);
            padding: 12px 15px;
            color: var(--light);
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-range {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .form-range::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
        }

        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--primary);
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }

        .color-picker-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 50px;
            height: 40px;
            border: none;
            border-radius: var(--border-radius-small);
            cursor: pointer;
            background: none;
        }

        .font-preview {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-small);
            padding: 15px;
            margin-top: 10px;
            text-align: center;
            font-size: 18px;
        }

        .website-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .website-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-small);
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .website-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--primary);
            transform: translateX(-3px);
        }

        .website-item.active {
            background: var(--gradient-primary);
            border-color: var(--primary);
            box-shadow: var(--shadow-medium);
        }

        .website-info {
            flex: 1;
        }

        .website-name {
            font-weight: 600;
            margin-bottom: 3px;
            font-size: 14px;
        }

        .website-category {
            font-size: 11px;
            opacity: 0.8;
        }

        .website-price {
            font-size: 14px;
            font-weight: 700;
            color: var(--success);
        }

        .btn {
            background: var(--gradient-primary);
            border: none;
            border-radius: var(--border-radius-small);
            color: white;
            padding: 12px 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn.success {
            background: var(--gradient-success);
        }

        .btn.danger {
            background: var(--gradient-danger);
        }

        .btn.small {
            padding: 8px 16px;
            font-size: 12px;
        }

        /* Media Upload Area */
        .upload-area {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: var(--border-radius);
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .upload-area:hover {
            border-color: var(--primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .upload-area.drag-over {
            border-color: var(--success);
            background: rgba(38, 222, 129, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.7;
        }

        .upload-text {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 12px;
            opacity: 0.7;
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .media-item {
            aspect-ratio: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-small);
            cursor: pointer;
            transition: all 0.3s ease;
            background-size: cover;
            background-position: center;
            position: relative;
            overflow: hidden;
        }

        .media-item:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-medium);
        }

        .media-item .remove-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            background: var(--danger);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 10px;
            cursor: pointer;
            display: none;
        }

        .media-item:hover .remove-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Cloud Settings */
        .cloud-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-indicator.disconnected {
            background: var(--danger);
        }

        .status-indicator.connecting {
            background: var(--warning);
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .cloud-info {
            flex: 1;
        }

        .cloud-title {
            font-weight: 600;
            font-size: 14px;
        }

        .cloud-subtitle {
            font-size: 12px;
            opacity: 0.7;
        }

        /* Canvas Area - Enhanced */
        .center-canvas {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.3);
        }

        .canvas-header {
            height: 70px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
        }

        .website-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--light);
        }

        .canvas-controls {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .device-controls {
            display: flex;
            gap: 5px;
        }

        .device-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius-small);
            padding: 8px 12px;
            color: var(--light);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
        }

        .device-btn.active {
            background: var(--gradient-primary);
            border-color: var(--primary);
        }

        .device-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .canvas-viewport {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 25px;
            overflow: auto;
        }

        .website-preview {
            width: 100%;
            max-width: 1200px;
            height: 100%;
            background: var(--light);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-heavy);
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .website-preview.tablet {
            max-width: 768px;
        }

        .website-preview.mobile {
            max-width: 375px;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: var(--border-radius);
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            font-size: 18px;
            color: rgba(255, 255, 255, 0.7);
            flex-direction: column;
            gap: 20px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications - Enhanced */
        .notification {
            position: fixed;
            top: 25px;
            right: 25px;
            background: rgba(26, 26, 46, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--border-radius);
            padding: 20px 25px;
            color: var(--light);
            font-weight: 500;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            box-shadow: var(--shadow-medium);
            min-width: 320px;
            max-width: 500px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-left: 4px solid var(--success);
        }

        .notification.error {
            border-left: 4px solid var(--danger);
        }

        .notification.warning {
            border-left: 4px solid var(--warning);
        }

        .notification-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .notification-text {
            font-size: 14px;
            opacity: 0.9;
            line-height: 1.4;
        }

        .status-bar {
            height: 50px;
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 25px;
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        .status-left, .status-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-indicator-bar {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success);
        }

        .status-indicator-bar.loading {
            background: var(--warning);
            animation: pulse 1s ease-in-out infinite;
        }

        .status-indicator-bar.error {
            background: var(--danger);
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .left-sidebar {
                width: 320px;
            }
        }

        @media (max-width: 768px) {
            .editor-container {
                flex-direction: column;
            }
            
            .left-sidebar {
                width: 100%;
                max-height: 40vh;
            }
            
            .canvas-header {
                padding: 0 15px;
            }
            
            .canvas-viewport {
                padding: 15px;
            }
        }

        /* Advanced Typography */
        .typography-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .range-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .range-value {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            min-width: 50px;
            text-align: center;
        }

        /* Animation Controls */
        .animation-preview {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            padding: 20px;
            text-align: center;
            margin-top: 15px;
        }

        .animation-demo {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: 50%;
            margin: 0 auto;
            transition: all 0.5s ease;
        }

        .animation-demo.fadeIn {
            animation: fadeIn 2s ease-in-out infinite;
        }

        .animation-demo.slideUp {
            animation: slideUp 2s ease-in-out infinite;
        }

        .animation-demo.bounce {
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes fadeIn {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes slideUp {
            0%, 100% { transform: translateY(10px); }
            50% { transform: translateY(-10px); }
        }

        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
    </style>
</head>
<body>
    <div class="editor-container">
        <!-- Left Sidebar - Enhanced -->
        <div class="left-sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-magic"></i>
                    WebMaster Pro Advanced
                </div>
            </div>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab('content')">
                    <i class="fas fa-edit"></i><br>תוכן
                </button>
                <button class="tab-btn" onclick="switchTab('design')">
                    <i class="fas fa-palette"></i><br>עיצוב
                </button>
                <button class="tab-btn" onclick="switchTab('media')">
                    <i class="fas fa-images"></i><br>מדיה
                </button>
                <button class="tab-btn" onclick="switchTab('cloud')">
                    <i class="fas fa-cloud"></i><br>ענן
                </button>
            </div>
            
            <div class="sidebar-content">
                <!-- Content Tab -->
                <div class="tab-content active" id="contentTab">
                    <!-- Website Selection -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-globe"></i>
                            בחר אתר לעריכה
                        </div>
                        
                        <div class="website-list" id="websiteList">
                            <!-- האתרים יטענו כאן דינמית -->
                        </div>
                    </div>

                    <!-- Website Details -->
                    <div class="section" id="websiteDetails" style="display: none;">
                        <div class="section-title">
                            <i class="fas fa-cog"></i>
                            פרטי האתר
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">שם העסק</label>
                            <input type="text" class="form-input" id="businessName" onchange="updateWebsiteContent()">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">תיאור העסק</label>
                            <textarea class="form-input form-textarea" id="businessDescription" onchange="updateWebsiteContent()"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">טלפון</label>
                            <input type="text" class="form-input" id="phone" onchange="updateWebsiteContent()">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">דוא"ל</label>
                            <input type="email" class="form-input" id="email" onchange="updateWebsiteContent()">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">כתובת</label>
                            <input type="text" class="form-input" id="address" onchange="updateWebsiteContent()">
                        </div>
                        
                        <button class="btn success" onclick="saveWebsite()">
                            <i class="fas fa-save"></i>
                            שמור שינויים
                        </button>
                        <button class="btn secondary" onclick="previewWebsite()">
                            <i class="fas fa-eye"></i>
                            תצוגה מקדימה
                        </button>
                    </div>
                </div>

                <!-- Design Tab -->
                <div class="tab-content" id="designTab">
                    <!-- Colors -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-palette"></i>
                            צבעים וערכת נושא
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">צבע ראשי</label>
                            <div class="color-picker-group">
                                <input type="text" class="form-input" id="primaryColor" value="#667eea" onchange="updateColors()">
                                <input type="color" class="color-input" id="primaryColorPicker" value="#667eea" onchange="updateColorFromPicker('primary', this.value)">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">צבע משני</label>
                            <div class="color-picker-group">
                                <input type="text" class="form-input" id="secondaryColor" value="#764ba2" onchange="updateColors()">
                                <input type="color" class="color-input" id="secondaryColorPicker" value="#764ba2" onchange="updateColorFromPicker('secondary', this.value)">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">צבע רקע</label>
                            <div class="color-picker-group">
                                <input type="text" class="form-input" id="backgroundColor" value="#ffffff" onchange="updateColors()">
                                <input type="color" class="color-input" id="backgroundColorPicker" value="#ffffff" onchange="updateColorFromPicker('background', this.value)">
                            </div>
                        </div>
                    </div>

                    <!-- Typography -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-font"></i>
                            טיפוגרפיה מתקדמת
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">גופן ראשי</label>
                            <select class="form-select" id="primaryFont" onchange="updateTypography()">
                                <option value="Assistant">Assistant (עברית)</option>
                                <option value="Inter">Inter (אנגלית)</option>
                                <option value="Heebo">Heebo (עברית מודרנית)</option>
                                <option value="Rubik">Rubik (עברית עגולה)</option>
                                <option value="Arial">Arial (קלאסי)</option>
                                <option value="Georgia">Georgia (סריף)</option>
                            </select>
                        </div>
                        
                        <div class="typography-controls">
                            <div class="form-group">
                                <label class="form-label">גודל כותרות</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="headingSize" min="24" max="72" value="48" onchange="updateTypography()">
                                    <span class="range-value" id="headingSizeValue">48px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">גודל טקסט</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="textSize" min="12" max="24" value="16" onchange="updateTypography()">
                                    <span class="range-value" id="textSizeValue">16px</span>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">עובי גופן</label>
                                <select class="form-select" id="fontWeight" onchange="updateTypography()">
                                    <option value="300">דק (300)</option>
                                    <option value="400">רגיל (400)</option>
                                    <option value="500">בינוני (500)</option>
                                    <option value="600" selected>שמן (600)</option>
                                    <option value="700">עבה (700)</option>
                                    <option value="800">עבה מאוד (800)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">ריווח שורות</label>
                                <div class="range-group">
                                    <input type="range" class="form-range" id="lineHeight" min="1" max="2" step="0.1" value="1.6" onchange="updateTypography()">
                                    <span class="range-value" id="lineHeightValue">1.6</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="font-preview" id="fontPreview">
                            <div style="font-size: 24px; margin-bottom: 10px;">כותרת לדוגמה</div>
                            <div style="font-size: 16px;">זהו טקסט לדוגמה להצגת הגופן והגדרות הטיפוגרפיה.</div>
                        </div>
                    </div>

                    <!-- Animations -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-magic"></i>
                            אנימציות ואפקטים
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">אנימציית כניסה</label>
                            <select class="form-select" id="entranceAnimation" onchange="updateAnimations()">
                                <option value="none">ללא אנימציה</option>
                                <option value="fadeIn">Fade In</option>
                                <option value="slideUp">Slide Up</option>
                                <option value="slideDown">Slide Down</option>
                                <option value="slideLeft">Slide Left</option>
                                <option value="slideRight">Slide Right</option>
                                <option value="zoomIn">Zoom In</option>
                                <option value="bounce">Bounce</option>
                                <option value="flipIn">Flip In</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">מהירות אנימציה</label>
                            <div class="range-group">
                                <input type="range" class="form-range" id="animationSpeed" min="0.3" max="2" step="0.1" value="0.8" onchange="updateAnimations()">
                                <span class="range-value" id="animationSpeedValue">0.8s</span>
                            </div>
                        </div>
                        
                        <div class="animation-preview">
                            <div class="animation-demo" id="animationDemo"></div>
                            <p style="margin-top: 10px; font-size: 12px; opacity: 0.7;">תצוגה מקדימה של האנימציה</p>
                        </div>
                    </div>
                </div>

                <!-- Media Tab -->
                <div class="tab-content" id="mediaTab">
                    <!-- Image Upload -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-image"></i>
                            העלאת תמונות
                        </div>
                        
                        <div class="upload-area" id="imageUpload" onclick="document.getElementById('imageInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">העלה תמונות</div>
                            <div class="upload-hint">לחץ או גרור תמונות לכאן<br>JPG, PNG, WebP עד 5MB</div>
                        </div>
                        
                        <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(this.files)">
                        
                        <div class="media-grid" id="imageGrid">
                            <!-- התמונות יופיעו כאן -->
                        </div>
                    </div>

                    <!-- Background Settings -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-image"></i>
                            רקע האתר
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">סוג רקע</label>
                            <select class="form-select" id="backgroundType" onchange="updateBackgroundSettings()">
                                <option value="color">צבע אחיד</option>
                                <option value="gradient">גרדיאנט</option>
                                <option value="image">תמונת רקע</option>
                                <option value="pattern">תבנית</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="gradientControls" style="display: none;">
                            <label class="form-label">גרדיאנט מותאם</label>
                            <div class="color-picker-group">
                                <input type="text" class="form-input" id="gradientStart" value="#667eea" onchange="updateBackground()">
                                <input type="color" class="color-input" id="gradientStartPicker" value="#667eea">
                            </div>
                            <div class="color-picker-group" style="margin-top: 10px;">
                                <input type="text" class="form-input" id="gradientEnd" value="#764ba2" onchange="updateBackground()">
                                <input type="color" class="color-input" id="gradientEndPicker" value="#764ba2">
                            </div>
                        </div>
                        
                        <button class="btn secondary small" onclick="selectBackgroundImage()">
                            <i class="fas fa-image"></i>
                            בחר תמונת רקע
                        </button>
                    </div>

                    <!-- Video Support -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-video"></i>
                            סרטוני רקע
                        </div>
                        
                        <div class="upload-area" onclick="document.getElementById('videoInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-video"></i>
                            </div>
                            <div class="upload-text">העלה סרטון רקע</div>
                            <div class="upload-hint">MP4, WebM עד 50MB</div>
                        </div>
                        
                        <input type="file" id="videoInput" accept="video/*" style="display: none;" onchange="handleVideoUpload(this.files)">
                    </div>
                </div>

                <!-- Cloud Tab -->
                <div class="tab-content" id="cloudTab">
                    <!-- Cloud Status -->
                    <div class="cloud-status" id="cloudStatus">
                        <div class="status-indicator disconnected" id="cloudIndicator"></div>
                        <div class="cloud-info">
                            <div class="cloud-title">Supabase Cloud</div>
                            <div class="cloud-subtitle" id="cloudSubtitle">לא מחובר</div>
                        </div>
                    </div>

                    <!-- Cloud Settings -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-cog"></i>
                            הגדרות ענן
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Supabase URL</label>
                            <input type="text" class="form-input" id="supabaseUrl" placeholder="https://xxxxx.supabase.co">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">API Key</label>
                            <input type="password" class="form-input" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
                        </div>
                        
                        <button class="btn success" onclick="connectToCloud()">
                            <i class="fas fa-plug"></i>
                            התחבר לענן
                        </button>
                        <button class="btn danger" onclick="disconnectFromCloud()">
                            <i class="fas fa-unlink"></i>
                            התנתק מהענן
                        </button>
                    </div>

                    <!-- Auto Sync -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-sync"></i>
                            סנכרון אוטומטי
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="autoSync" onchange="toggleAutoSync()">
                                סנכרון אוטומטי כל 30 שניות
                            </label>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">
                                <input type="checkbox" id="autoBackup" onchange="toggleAutoBackup()">
                                גיבוי אוטומטי יומי
                            </label>
                        </div>
                        
                        <button class="btn secondary" onclick="manualSync()">
                            <i class="fas fa-sync-alt"></i>
                            סנכרון ידני עכשיו
                        </button>
                    </div>

                    <!-- Backup & Restore -->
                    <div class="section">
                        <div class="section-title">
                            <i class="fas fa-database"></i>
                            גיבוי ושחזור
                        </div>
                        
                        <button class="btn secondary" onclick="createBackup()">
                            <i class="fas fa-download"></i>
                            צור גיבוי מלא
                        </button>
                        <button class="btn secondary" onclick="restoreBackup()">
                            <i class="fas fa-upload"></i>
                            שחזר מגיבוי
                        </button>
                        
                        <div id="backupHistory" style="margin-top: 20px;">
                            <!-- היסטוריית גיבויים תוצג כאן -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Center Canvas -->
        <div class="center-canvas">
            <div class="canvas-header">
                <div class="website-title" id="currentWebsiteTitle">בחר אתר לעריכה</div>
                
                <div class="canvas-controls">
                    <div class="device-controls">
                        <button class="device-btn active" onclick="setDevice('desktop')" data-device="desktop">
                            <i class="fas fa-desktop"></i>
                            Desktop
                        </button>
                        <button class="device-btn" onclick="setDevice('tablet')" data-device="tablet">
                            <i class="fas fa-tablet-alt"></i>
                            Tablet
                        </button>
                        <button class="device-btn" onclick="setDevice('mobile')" data-device="mobile">
                            <i class="fas fa-mobile-alt"></i>
                            Mobile
                        </button>
                    </div>
                    
                    <button class="btn secondary small" onclick="previewWebsite()">
                        <i class="fas fa-eye"></i>
                        תצוגה מקדימה
                    </button>
                    
                    <button class="btn success small" onclick="saveWebsite()">
                        <i class="fas fa-save"></i>
                        שמור
                    </button>
                </div>
            </div>
            
            <div class="canvas-viewport">
                <div class="website-preview" id="websitePreview">
                    <div class="loading" id="loadingMessage">
                        <div class="spinner"></div>
                        <div>בחר אתר מהרשימה כדי להתחיל לערוך</div>
                    </div>
                    <iframe class="preview-frame" id="previewFrame" style="display: none;"></iframe>
                </div>
            </div>
            
            <div class="status-bar">
                <div class="status-left">
                    <div class="status-item">
                        <div class="status-indicator-bar" id="statusIndicator"></div>
                        <span id="statusText">מוכן לעריכה</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-globe"></i>
                        <span id="websiteCount">11 אתרים זמינים</span>
                    </div>
                </div>
                <div class="status-right">
                    <div class="status-item">
                        <i class="fas fa-cloud"></i>
                        <span id="cloudStatusText">לא מחובר</span>
                    </div>
                    <div class="status-item">
                        <i class="fas fa-clock"></i>
                        <span id="lastSaved">עדכון אחרון: עכשיו</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ========== Global Variables ==========
        let currentWebsite = null;
        let currentDevice = 'desktop';
        let isLoading = false;
        let activeTab = 'content';
        let uploadedImages = [];
        let cloudConnected = false;
        let autoSyncInterval = null;

        // ========== Website Database ==========
        const availableWebsites = {
            'aesthetic-clinic': {
                id: 'aesthetic-clinic',
                name: 'קליניקת יופי פרמיום',
                category: 'אסתטיקה רפואית',
                price: 3200,
                file: 'websites/aesthetic-clinic.html',
                businessName: 'קליניקת יופי פרמיום',
                description: 'מרכז רפואה אסתטית מתקדמת',
                phone: '050-1234567',
                email: 'info@beauty-clinic.co.il',
                address: 'תל אביב, ישראל'
            },
            'dr-michal-rosen': {
                id: 'dr-michal-rosen',
                name: 'ד"ר מיכל רוזן',
                category: 'רפואה אסתטית',
                price: 2800,
                file: 'websites/dr-michal-rosen.html',
                businessName: 'ד"ר מיכל רוזן',
                description: 'רפואה אסתטית מקצועית',
                phone: '052-9876543',
                email: 'dr.rosen@example.co.il',
                address: 'רמת גן, ישראל'
            },
            'real-estate': {
                id: 'real-estate',
                name: 'נדל"ן פרמיום',
                category: 'השקעות נדל"ן',
                price: 2700,
                file: 'websites/real-estate.html',
                businessName: 'נדל"ן פרמיום',
                description: 'השקעות נדל"ן יוקרתיות',
                phone: '053-1111111',
                email: 'info@premium-real-estate.co.il',
                address: 'הרצליה, ישראל'
            },
            'law-firm': {
                id: 'law-firm',
                name: 'משרד ברקוביץ',
                category: 'שירותים משפטיים',
                price: 2500,
                file: 'websites/law-firm.html',
                businessName: 'משרד ברקוביץ',
                description: 'עורכי דין מובילים',
                phone: '054-2222222',
                email: 'office@barkovich-law.co.il',
                address: 'ירושלים, ישראל'
            },
            'nutritionist': {
                id: 'nutritionist',
                name: 'ד"ר שרה כהן',
                category: 'תזונה קלינית',
                price: 2400,
                file: 'websites/nutritionist.html',
                businessName: 'ד"ר שרה כהן',
                description: 'תזונאית קלינית מומחית',
                phone: '055-3333333',
                email: 'sarah.cohen@nutrition.co.il',
                address: 'פתח תקווה, ישראל'
            },
            'multibrawn': {
                id: 'multibrawn',
                name: 'מולטיבראון',
                category: 'נופש ואירועים',
                price: 2300,
                file: 'websites/multibrawn.html',
                businessName: 'מולטיבראון',
                description: 'נופש ואירועים יוקרתיים',
                phone: '056-4444444',
                email: 'info@multibrawn.co.il',
                address: 'אילת, ישראל'
            },
            'fitness-coach': {
                id: 'fitness-coach',
                name: 'דני פיט',
                category: 'אימון אישי',
                price: 2200,
                file: 'websites/fitness-co.html',
                businessName: 'דני פיט',
                description: 'מאמן כושר אישי מקצועי',
                phone: '057-5555555',
                email: 'danny@fit-coaching.co.il',
                address: 'חולון, ישראל'
            },
            'tutor': {
                id: 'tutor',
                name: 'ד"ר רונית לוי',
                category: 'חינוך פרטי',
                price: 2100,
                file: 'websites/tutor.html',
                businessName: 'ד"ר רונית לוי',
                description: 'מורה פרטית מומחית',
                phone: '058-6666666',
                email: 'ronit.levy@education.co.il',
                address: 'כפר סבא, ישראל'
            },
            'accountant': {
                id: 'accountant',
                name: 'רינה לוי CPA',
                category: 'חשבונות ושכר',
                price: 2000,
                file: 'websites/accountant.html',
                businessName: 'רינה לוי CPA',
                description: 'חשבת שכר מוסמכת',
                phone: '059-7777777',
                email: 'rina.levy@accounting.co.il',
                address: 'ראשון לציון, ישראל'
            },
            'yoga-studio': {
                id: 'yoga-studio',
                name: 'סטודיו אוהם',
                category: 'יוגה ומדיטציה',
                price: 1900,
                file: 'websites/yoga-studio.html',
                businessName: 'סטודיו אוהם',
                description: 'יוגה ומדיטציה מקצועית',
                phone: '050-8888888',
                email: 'info@ohm-studio.co.il',
                address: 'תל אביב, ישראל'
            },
            'beauty-salon': {
                id: 'beauty-salon',
                name: 'מספרה BELLA',
                category: 'יופי ועיצוב שיער',
                price: 1700,
                file: 'websites/beauty-salon.html',
                businessName: 'מספרה BELLA',
                description: 'מספרה יוקרתית מקצועית',
                phone: '051-9999999',
                email: 'bella@hair-salon.co.il',
                address: 'נתניה, ישראל'
            }
        };

        // ========== Core Functions ==========
        function initializeEditor() {
            console.log('🚀 Initializing WebMaster Pro Advanced Editor...');
            
            // Check URL parameters for specific website
            const urlParams = new URLSearchParams(window.location.search);
            const websiteParam = urlParams.get('website');
            
            populateWebsiteList();
            initializeEventListeners();
            
            if (websiteParam && availableWebsites[websiteParam]) {
                loadWebsite(websiteParam);
                showNotification('מוכן לעריכה', `🎯 טוען ${availableWebsites[websiteParam].name}...`, 'success');
            }
            
            updateStatusBar();
            console.log('✅ Advanced Editor initialized successfully');
        }

        function populateWebsiteList() {
            const websiteList = document.getElementById('websiteList');
            websiteList.innerHTML = '';
            
            Object.values(availableWebsites).forEach(website => {
                const websiteItem = document.createElement('div');
                websiteItem.className = 'website-item';
                websiteItem.onclick = () => loadWebsite(website.id);
                
                websiteItem.innerHTML = `
                    <div class="website-info">
                        <div class="website-name">${website.name}</div>
                        <div class="website-category">${website.category}</div>
                    </div>
                    <div class="website-price">₪${website.price.toLocaleString()}</div>
                `;
                
                websiteList.appendChild(websiteItem);
            });
        }

        function loadWebsite(websiteId) {
            const website = availableWebsites[websiteId];
            if (!website) {
                showNotification('שגיאה', '❌ אתר לא נמצא!', 'error');
                return;
            }

            setLoadingState(true);
            currentWebsite = website;
            
            // Update UI
            updateActiveWebsiteItem(websiteId);
            document.getElementById('currentWebsiteTitle').textContent = `עורך: ${website.name}`;
            
            // Show website details section
            document.getElementById('websiteDetails').style.display = 'block';
            
            // Load website data into form
            document.getElementById('businessName').value = website.businessName || '';
            document.getElementById('businessDescription').value = website.description || '';
            document.getElementById('phone').value = website.phone || '';
            document.getElementById('email').value = website.email || '';
            document.getElementById('address').value = website.address || '';
            
            // Try to load the actual website file
            loadWebsiteFile(website);
            
            showNotification('הצלחה', `✅ ${website.name} נטען בהצלחה!`, 'success');
            updateStatusBar();
        }

        function loadWebsiteFile(website) {
            const frame = document.getElementById('previewFrame');
            const loadingMessage = document.getElementById('loadingMessage');
            
            // Try to load the actual file
            fetch(website.file)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('File not found');
                    }
                    return response.text();
                })
                .then(html => {
                    // Make the HTML editable
                    const editableHtml = makeHTMLEditable(html, website);
                    frame.srcdoc = editableHtml;
                    
                    frame.style.display = 'block';
                    loadingMessage.style.display = 'none';
                    setLoadingState(false);
                    
                    showNotification('הצלחה', `📄 קובץ ${website.name} נטען בהצלחה!`, 'success');
                })
                .catch(error => {
                    console.log('File not found, loading template:', error);
                    loadWebsiteTemplate(website);
                });
        }

        function loadWebsiteTemplate(website) {
            const templateHTML = generateWebsiteTemplate(website);
            const frame = document.getElementById('previewFrame');
            const loadingMessage = document.getElementById('loadingMessage');
            
            frame.srcdoc = templateHTML;
            frame.style.display = 'block';
            loadingMessage.style.display = 'none';
            setLoadingState(false);
            
            showNotification('תבנית', `📝 נטענה תבנית עבור ${website.name}`, 'success');
        }

        function makeHTMLEditable(html, website) {
            let editableHtml = html;
            
            // Replace placeholders with actual data
            editableHtml = editableHtml.replace(/\[BUSINESS_NAME\]/g, website.businessName);
            editableHtml = editableHtml.replace(/\[BUSINESS_DESCRIPTION\]/g, website.description);
            editableHtml = editableHtml.replace(/\[PHONE\]/g, website.phone);
            editableHtml = editableHtml.replace(/\[EMAIL\]/g, website.email);
            editableHtml = editableHtml.replace(/\[ADDRESS\]/g, website.address);
            
            // Add advanced editable script
            const editableScript = `
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        // Add editable class to elements
                        const editableElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span:not(.icon), .btn, a:not(.skip-edit)');
                        
                        editableElements.forEach((element, index) => {
                            if (!element.closest('script') && !element.closest('style')) {
                                element.classList.add('editable');
                                element.setAttribute('data-element', element.tagName.toLowerCase() + '-' + index);
                                
                                element.addEventListener('click', function(e) {
                                    e.stopPropagation();
                                    selectElement(this);
                                });
                                
                                element.addEventListener('dblclick', function(e) {
                                    e.preventDefault();
                                    this.contentEditable = true;
                                    this.focus();
                                    selectText(this);
                                });
                                
                                element.addEventListener('blur', function() {
                                    this.contentEditable = false;
                                    if (window.parent !== window) {
                                        window.parent.onContentChanged(this);
                                    }
                                });
                                
                                element.addEventListener('keydown', function(e) {
                                    if (e.key === 'Enter' && !e.shiftKey) {
                                        e.preventDefault();
                                        this.blur();
                                    }
                                });
                            }
                        });
                        
                        // Add advanced editable styles
                        const style = document.createElement('style');
                        style.textContent = \`
                            .editable { 
                                transition: all 0.3s ease; 
                                cursor: pointer;
                                min-height: 20px;
                                position: relative;
                                border-radius: 4px;
                            }
                            .editable:hover { 
                                background: rgba(102, 126, 234, 0.1) !important; 
                                outline: 2px dashed rgba(102, 126, 234, 0.5);
                                box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
                            }
                            .editable.selected { 
                                outline: 3px solid #667eea !important; 
                                background: rgba(102, 126, 234, 0.2) !important;
                                box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
                            }
                            .editable[contenteditable="true"] {
                                outline: 3px solid #26de81 !important;
                                background: rgba(38, 222, 129, 0.1) !important;
                                box-shadow: 0 0 20px rgba(38, 222, 129, 0.3);
                            }
                            .editable[contenteditable="true"]:focus {
                                outline: 3px solid #26de81 !important;
                            }
                        \`;
                        document.head.appendChild(style);
                    });
                    
                    function selectElement(element) {
                        const selected = document.querySelector('.editable.selected');
                        if (selected) selected.classList.remove('selected');
                        
                        element.classList.add('selected');
                        
                        if (window.parent !== window) {
                            window.parent.onElementSelected(element);
                        }
                    }
                    
                    function selectText(element) {
                        const range = document.createRange();
                        range.selectNodeContents(element);
                        const selection = window.getSelection();
                        selection.removeAllRanges();
                        selection.addRange(range);
                    }
                </script>
            `;
            
            editableHtml = editableHtml.replace('</body>', editableScript + '</body>');
            
            return editableHtml;
        }

        function generateWebsiteTemplate(website) {
            return `
                <!DOCTYPE html>
                <html lang="he" dir="rtl">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${website.businessName}</title>
                    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
                    <style>
                        * { margin: 0; padding: 0; box-sizing: border-box; }
                        body { font-family: 'Assistant', Arial, sans-serif; line-height: 1.6; color: #333; }
                        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
                        .hero { 
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
                            color: white; 
                            padding: 100px 20px; 
                            text-align: center; 
                        }
                        .section { padding: 80px 20px; }
                        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; }
                        .card { background: #f8f9fa; padding: 30px; border-radius: 15px; text-align: center; transition: transform 0.3s ease; }
                        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
                        .btn { 
                            background: #667eea; 
                            color: white; 
                            padding: 15px 30px; 
                            border: none; 
                            border-radius: 25px; 
                            font-weight: 600; 
                            cursor: pointer; 
                            transition: all 0.3s ease;
                            text-decoration: none;
                            display: inline-block;
                        }
                        .btn:hover { background: #5a67d8; transform: translateY(-2px); }
                    </style>
                </head>
                <body>
                    <header class="hero">
                        <div class="container">
                            <h1 class="editable" data-element="main-title">${website.businessName}</h1>
                            <p class="editable" data-element="main-subtitle">${website.description}</p>
                            <p class="editable" data-element="hero-description">שירות מקצועי ואמין בתחום ${website.category}</p>
                            <a href="tel:${website.phone}" class="btn editable" data-element="cta-button">צור קשר עכשיו</a>
                        </div>
                    </header>
                    
                    <section class="section">
                        <div class="container">
                            <h2 class="editable" data-element="services-title" style="text-align: center; margin-bottom: 50px; font-size: 2.5em;">השירותים שלנו</h2>
                            <div class="grid">
                                <div class="card">
                                    <div style="font-size: 3em; margin-bottom: 20px;">⭐</div>
                                    <h3 class="editable" data-element="service1-title">שירות מקצועי</h3>
                                    <p class="editable" data-element="service1-desc">תיאור השירות הראשון של ${website.businessName}</p>
                                    <p class="editable" data-element="service1-price" style="font-weight: 600; color: #667eea; margin-top: 15px;">החל מ-₪200</p>
                                </div>
                                <div class="card">
                                    <div style="font-size: 3em; margin-bottom: 20px;">🎯</div>
                                    <h3 class="editable" data-element="service2-title">פתרונות מותאמים</h3>
                                    <p class="editable" data-element="service2-desc">תיאור השירות השני עם התמחות ב${website.category}</p>
                                    <p class="editable" data-element="service2-price" style="font-weight: 600; color: #667eea; margin-top: 15px;">החל מ-₪350</p>
                                </div>
                                <div class="card">
                                    <div style="font-size: 3em; margin-bottom: 20px;">💎</div>
                                    <h3 class="editable" data-element="service3-title">שירות VIP</h3>
                                    <p class="editable" data-element="service3-desc">השירות המתקדם ביותר שלנו עם מעקב אישי</p>
                                    <p class="editable" data-element="service3-price" style="font-weight: 600; color: #667eea; margin-top: 15px;">החל מ-₪500</p>
                                </div>
                            </div>
                        </div>
                    </section>
                    
                    <section class="section" style="background: #f8f9fa;">
                        <div class="container">
                            <h2 class="editable" data-element="about-title" style="text-align: center; margin-bottom: 30px;">למה לבחור בנו?</h2>
                            <div style="max-width: 800px; margin: 0 auto; text-align: center;">
                                <p class="editable" data-element="about-text" style="font-size: 1.2em; line-height: 1.8;">
                                    אנחנו מתמחים ב${website.category} ומעניקים שירות מקצועי ואישי לכל לקוח. 
                                    עם ניסיון של שנים רבות בתחום, אנחנו מבטיחים את השירות הטוב ביותר.
                                </p>
                            </div>
                        </div>
                    </section>
                    
                    <footer style="background: #333; color: white; padding: 40px 20px; text-align: center;">
                        <div class="container">
                            <h3 class="editable" data-element="contact-title">${website.businessName} - צרו קשר</h3>
                            <p class="editable" data-element="phone">📞 ${website.phone}</p>
                            <p class="editable" data-element="email">✉️ ${website.email}</p>
                            <p class="editable" data-element="address">📍 ${website.address}</p>
                            <p style="margin-top: 20px; opacity: 0.7;">© 2025 ${website.businessName}. כל הזכויות שמורות.</p>
                        </div>
                    </footer>
                </body>
                </html>
            `;
        }

        function updateActiveWebsiteItem(websiteId) {
            document.querySelectorAll('.website-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const items = document.querySelectorAll('.website-item');
            const websites = Object.keys(availableWebsites);
            const index = websites.indexOf(websiteId);
            if (index !== -1 && items[index]) {
                items[index].classList.add('active');
            }
        }

        function updateWebsiteContent() {
            if (!currentWebsite) return;
            
            const businessName = document.getElementById('businessName').value;
            const businessDescription = document.getElementById('businessDescription').value;
            const phone = document.getElementById('phone').value;
            const email = document.getElementById('email').value;
            const address = document.getElementById('address').value;
            
            currentWebsite.businessName = businessName;
            currentWebsite.description = businessDescription;
            currentWebsite.phone = phone;
            currentWebsite.email = email;
            currentWebsite.address = address;
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const doc = frame.contentDocument;
                
                const elements = {
                    'main-title': businessName,
                    'main-subtitle': businessDescription,
                    'hero-description': `שירות מקצועי ואמין בתחום ${currentWebsite.category}`,
                    'contact-title': `${businessName} - צרו קשר`,
                    'phone': `📞 ${phone}`,
                    'email': `✉️ ${email}`,
                    'address': `📍 ${address}`
                };
                
                Object.entries(elements).forEach(([dataElement, text]) => {
                    const element = doc.querySelector(`[data-element="${dataElement}"]`);
                    if (element && text) {
                        element.textContent = text;
                    }
                });
                
                const phoneLinks = doc.querySelectorAll('a[href^="tel:"]');
                phoneLinks.forEach(link => {
                    link.href = `tel:${phone}`;
                });
                
                const emailLinks = doc.querySelectorAll('a[href^="mailto:"]');
                emailLinks.forEach(link => {
                    link.href = `mailto:${email}`;
                });
            }
            
            showNotification('עדכון', '✅ תוכן האתר עודכן!', 'success');
            updateStatusBar();
            
            // Auto sync to cloud if connected
            if (cloudConnected) {
                syncToCloud();
            }
        }

        // ========== Tab Management ==========
        function switchTab(tabName) {
            activeTab = tabName;
            
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            showNotification('ניווט', `עבר לטאב ${getTabName(tabName)}`, 'success');
        }

        function getTabName(tabName) {
            const names = {
                'content': 'תוכן',
                'design': 'עיצוב',
                'media': 'מדיה',
                'cloud': 'ענן'
            };
            return names[tabName] || tabName;
        }

        // ========== Design Functions ==========
        function updateColors() {
            const primaryColor = document.getElementById('primaryColor').value;
            const secondaryColor = document.getElementById('secondaryColor').value;
            const backgroundColor = document.getElementById('backgroundColor').value;
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const doc = frame.contentDocument;
                const style = doc.createElement('style');
                style.textContent = `
                    :root {
                        --primary-color: ${primaryColor};
                        --secondary-color: ${secondaryColor};
                        --background-color: ${backgroundColor};
                    }
                    .hero {
                        background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%) !important;
                    }
                    .btn {
                        background: ${primaryColor} !important;
                    }
                    body {
                        background-color: ${backgroundColor} !important;
                    }
                `;
                doc.head.appendChild(style);
            }
            
            showNotification('עיצוב', '🎨 צבעי האתר עודכנו!', 'success');
        }

        function updateColorFromPicker(type, color) {
            document.getElementById(type + 'Color').value = color;
            document.getElementById(type + 'ColorPicker').value = color;
            updateColors();
        }

        function updateTypography() {
            const primaryFont = document.getElementById('primaryFont').value;
            const headingSize = document.getElementById('headingSize').value;
            const textSize = document.getElementById('textSize').value;
            const fontWeight = document.getElementById('fontWeight').value;
            const lineHeight = document.getElementById('lineHeight').value;
            
            // Update range value displays
            document.getElementById('headingSizeValue').textContent = headingSize + 'px';
            document.getElementById('textSizeValue').textContent = textSize + 'px';
            document.getElementById('lineHeightValue').textContent = lineHeight;
            
            // Update font preview
            const preview = document.getElementById('fontPreview');
            preview.style.fontFamily = primaryFont;
            preview.style.fontWeight = fontWeight;
            preview.style.lineHeight = lineHeight;
            preview.querySelector('div:first-child').style.fontSize = (headingSize * 0.5) + 'px';
            preview.querySelector('div:last-child').style.fontSize = textSize + 'px';
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const doc = frame.contentDocument;
                const style = doc.createElement('style');
                style.textContent = `
                    body {
                        font-family: '${primaryFont}', Arial, sans-serif !important;
                        font-size: ${textSize}px !important;
                        font-weight: ${fontWeight} !important;
                        line-height: ${lineHeight} !important;
                    }
                    h1, h2, h3, h4, h5, h6 {
                        font-family: '${primaryFont}', Arial, sans-serif !important;
                        font-weight: ${Math.max(fontWeight, 600)} !important;
                    }
                    h1 { font-size: ${headingSize}px !important; }
                    h2 { font-size: ${headingSize * 0.8}px !important; }
                    h3 { font-size: ${headingSize * 0.6}px !important; }
                `;
                doc.head.appendChild(style);
            }
            
            showNotification('טיפוגרפיה', '🔤 גופן וגדלים עודכנו!', 'success');
        }

        function updateAnimations() {
            const animation = document.getElementById('entranceAnimation').value;
            const speed = document.getElementById('animationSpeed').value;
            
            document.getElementById('animationSpeedValue').textContent = speed + 's';
            
            const demo = document.getElementById('animationDemo');
            demo.className = 'animation-demo';
            if (animation !== 'none') {
                demo.classList.add(animation);
            }
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const doc = frame.contentDocument;
                const style = doc.createElement('style');
                style.textContent = `
                    .editable {
                        animation: ${animation} ${speed}s ease-in-out;
                    }
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    @keyframes slideUp {
                        from { transform: translateY(50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @keyframes slideDown {
                        from { transform: translateY(-50px); opacity: 0; }
                        to { transform: translateY(0); opacity: 1; }
                    }
                    @keyframes slideLeft {
                        from { transform: translateX(50px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes slideRight {
                        from { transform: translateX(-50px); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                    @keyframes zoomIn {
                        from { transform: scale(0.8); opacity: 0; }
                        to { transform: scale(1); opacity: 1; }
                    }
                    @keyframes bounce {
                        0%, 20%, 53%, 80%, 100% { transform: translateY(0); }
                        40%, 43% { transform: translateY(-20px); }
                        70% { transform: translateY(-10px); }
                        90% { transform: translateY(-4px); }
                    }
                    @keyframes flipIn {
                        from { transform: perspective(400px) rotateY(90deg); opacity: 0; }
                        to { transform: perspective(400px) rotateY(0deg); opacity: 1; }
                    }
                `;
                doc.head.appendChild(style);
            }
            
            showNotification('אנימציה', '✨ אנימציות עודכנו!', 'success');
        }

        // ========== Media Functions ==========
        function initializeEventListeners() {
            // Drag and drop for image upload
            const uploadArea = document.getElementById('imageUpload');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('drag-over');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('drag-over');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('drag-over');
                handleImageUpload(e.dataTransfer.files);
            });
        }

        function handleImageUpload(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageData = e.target.result;
                        uploadedImages.push({
                            name: file.name,
                            data: imageData,
                            type: file.type
                        });
                        addImageToGrid(imageData, file.name);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            showNotification('העלאה', `📷 הועלו ${files.length} תמונות בהצלחה!`, 'success');
        }

        function addImageToGrid(imageSrc, imageName) {
            const grid = document.getElementById('imageGrid');
            const imageItem = document.createElement('div');
            imageItem.className = 'media-item';
            imageItem.style.backgroundImage = `url(${imageSrc})`;
            imageItem.title = imageName;
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-btn';
            removeBtn.innerHTML = '<i class="fas fa-times"></i>';
            removeBtn.onclick = (e) => {
                e.stopPropagation();
                imageItem.remove();
                uploadedImages = uploadedImages.filter(img => img.data !== imageSrc);
                showNotification('מחיקה', 'תמונה נמחקה', 'warning');
            };
            
            imageItem.appendChild(removeBtn);
            imageItem.onclick = () => insertImageToWebsite(imageSrc);
            
            grid.appendChild(imageItem);
        }

        function insertImageToWebsite(imageSrc) {
            // This would insert the image into the selected element in the website
            showNotification('הוספה', '🖼️ תמונה הוספה לאתר!', 'success');
        }

        function handleVideoUpload(files) {
            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('video/')) {
                    showNotification('העלאה', `🎬 סרטון ${file.name} הועלה בהצלחה!`, 'success');
                } else {
                    showNotification('שגיאה', '❌ קובץ לא נתמך', 'error');
                }
            }
        }

        function updateBackgroundSettings() {
            const backgroundType = document.getElementById('backgroundType').value;
            const gradientControls = document.getElementById('gradientControls');
            
            if (backgroundType === 'gradient') {
                gradientControls.style.display = 'block';
            } else {
                gradientControls.style.display = 'none';
            }
            
            updateBackground();
        }

        function updateBackground() {
            const backgroundType = document.getElementById('backgroundType').value;
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const doc = frame.contentDocument;
                const style = doc.createElement('style');
                
                let backgroundCSS = '';
                
                switch(backgroundType) {
                    case 'gradient':
                        const startColor = document.getElementById('gradientStart').value;
                        const endColor = document.getElementById('gradientEnd').value;
                        backgroundCSS = `background: linear-gradient(135deg, ${startColor} 0%, ${endColor} 100%) !important;`;
                        break;
                    case 'pattern':
                        backgroundCSS = `background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="rgba(0,0,0,0.1)" stroke-width="1"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>') !important;`;
                        break;
                }
                
                if (backgroundCSS) {
                    style.textContent = `body { ${backgroundCSS} }`;
                    doc.head.appendChild(style);
                }
            }
            
            showNotification('רקע', '🖼️ רקע האתר עודכן!', 'success');
        }

        function selectBackgroundImage() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const imageSrc = e.target.result;
                        const frame = document.getElementById('previewFrame');
                        if (frame.contentDocument) {
                            const doc = frame.contentDocument;
                            const style = doc.createElement('style');
                            style.textContent = `
                                body {
                                    background-image: url('${imageSrc}') !important;
                                    background-size: cover !important;
                                    background-position: center !important;
                                    background-attachment: fixed !important;
                                }
                            `;
                            doc.head.appendChild(style);
                        }
                        showNotification('רקע', '🖼️ תמונת רקע הוגדרה!', 'success');
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        // ========== Cloud Functions ==========
        function connectToCloud() {
            const url = document.getElementById('supabaseUrl').value;
            const key = document.getElementById('supabaseKey').value;
            
            if (!url || !key) {
                showNotification('שגיאה', '❌ נא למלא URL ו-API Key', 'error');
                return;
            }
            
            setCloudStatus('connecting', 'מתחבר...');
            
            // Simulate connection (in real implementation, this would connect to Supabase)
            setTimeout(() => {
                cloudConnected = true;
                setCloudStatus('connected', 'מחובר בהצלחה');
                
                // Save credentials
                localStorage.setItem('supabase_url', url);
                localStorage.setItem('supabase_key', key);
                
                showNotification('ענן', '☁️ התחברות לענן בוצעה בהצלחה!', 'success');
                
                // Start auto sync if enabled
                if (document.getElementById('autoSync').checked) {
                    startAutoSync();
                }
            }, 2000);
        }

        function disconnectFromCloud() {
            cloudConnected = false;
            setCloudStatus('disconnected', 'לא מחובר');
            
            // Stop auto sync
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
            }
            
            // Clear credentials
            localStorage.removeItem('supabase_url');
            localStorage.removeItem('supabase_key');
            
            showNotification('ענן', '📴 התנתקות מהענן בוצעה', 'warning');
        }

        function setCloudStatus(status, message) {
            const indicator = document.getElementById('cloudIndicator');
            const subtitle = document.getElementById('cloudSubtitle');
            const statusText = document.getElementById('cloudStatusText');
            
            indicator.className = `status-indicator ${status}`;
            subtitle.textContent = message;
            statusText.textContent = message;
        }

        function toggleAutoSync() {
            const enabled = document.getElementById('autoSync').checked;
            
            if (enabled && cloudConnected) {
                startAutoSync();
                showNotification('סנכרון', '🔄 סנכרון אוטומטי הופעל', 'success');
            } else {
                stopAutoSync();
                showNotification('סנכרון', '⏸️ סנכרון אוטומטי הופסק', 'warning');
            }
        }

        function startAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            autoSyncInterval = setInterval(() => {
                if (cloudConnected && currentWebsite) {
                    syncToCloud();
                }
            }, 30000); // Every 30 seconds
        }

        function stopAutoSync() {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
                autoSyncInterval = null;
            }
        }

        function syncToCloud() {
            if (!cloudConnected || !currentWebsite) return;
            
            const frame = document.getElementById('previewFrame');
            let content = frame.srcdoc;
            
            if (!content && frame.contentDocument) {
                content = frame.contentDocument.documentElement.outerHTML;
            }
            
            const syncData = {
                website_id: currentWebsite.id,
                content: content,
                metadata: currentWebsite,
                timestamp: new Date().toISOString()
            };
            
            // Simulate cloud sync (in real implementation, this would sync to Supabase)
            console.log('Syncing to cloud:', syncData);
            showNotification('סנכרון', '☁️ סונכרן לענן בהצלחה', 'success');
        }

        function manualSync() {
            if (!cloudConnected) {
                showNotification('שגיאה', '❌ לא מחובר לענן', 'error');
                return;
            }
            
            syncToCloud();
        }

        function createBackup() {
            const backupData = {
                websites: {},
                settings: {
                    colors: {
                        primary: document.getElementById('primaryColor').value,
                        secondary: document.getElementById('secondaryColor').value,
                        background: document.getElementById('backgroundColor').value
                    },
                    typography: {
                        font: document.getElementById('primaryFont').value,
                        headingSize: document.getElementById('headingSize').value,
                        textSize: document.getElementById('textSize').value,
                        fontWeight: document.getElementById('fontWeight').value,
                        lineHeight: document.getElementById('lineHeight').value
                    }
                },
                uploadedImages: uploadedImages,
                timestamp: new Date().toISOString()
            };
            
            // Add all websites to backup
            Object.keys(availableWebsites).forEach(websiteId => {
                const savedData = localStorage.getItem(`webmaster_website_${websiteId}`);
                if (savedData) {
                    backupData.websites[websiteId] = JSON.parse(savedData);
                }
            });
            
            const blob = new Blob([JSON.stringify(backupData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `webmaster_pro_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('גיבוי', '💾 גיבוי מלא נוצר בהצלחה!', 'success');
        }

        function restoreBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const backupData = JSON.parse(e.target.result);
                            
                            // Restore websites
                            Object.entries(backupData.websites || {}).forEach(([websiteId, data]) => {
                                localStorage.setItem(`webmaster_website_${websiteId}`, JSON.stringify(data));
                            });
                            
                            // Restore settings
                            if (backupData.settings) {
                                const { colors, typography } = backupData.settings;
                                if (colors) {
                                    document.getElementById('primaryColor').value = colors.primary || '#667eea';
                                    document.getElementById('secondaryColor').value = colors.secondary || '#764ba2';
                                    document.getElementById('backgroundColor').value = colors.background || '#ffffff';
                                    document.getElementById('primaryColorPicker').value = colors.primary || '#667eea';
                                    document.getElementById('secondaryColorPicker').value = colors.secondary || '#764ba2';
                                    document.getElementById('backgroundColorPicker').value = colors.background || '#ffffff';
                                }
                                if (typography) {
                                    document.getElementById('primaryFont').value = typography.font || 'Assistant';
                                    document.getElementById('headingSize').value = typography.headingSize || '48';
                                    document.getElementById('textSize').value = typography.textSize || '16';
                                    document.getElementById('fontWeight').value = typography.fontWeight || '600';
                                    document.getElementById('lineHeight').value = typography.lineHeight || '1.6';
                                }
                            }
                            
                            // Restore uploaded images
                            if (backupData.uploadedImages) {
                                uploadedImages = backupData.uploadedImages;
                                const grid = document.getElementById('imageGrid');
                                grid.innerHTML = '';
                                uploadedImages.forEach(img => {
                                    addImageToGrid(img.data, img.name);
                                });
                            }
                            
                            showNotification('שחזור', '🔄 שחזור מגיבוי בוצע בהצלחה!', 'success');
                            
                        } catch (error) {
                            showNotification('שגיאה', '❌ שגיאה בשחזור הגיבוי', 'error');
                            console.error('Backup restore error:', error);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function toggleAutoBackup() {
            const enabled = document.getElementById('autoBackup').checked;
            
            if (enabled) {
                showNotification('גיבוי', '📅 גיבוי אוטומטי יומי הופעל', 'success');
                // Set up daily backup (in real implementation)
            } else {
                showNotification('גיבוי', '📅 גיבוי אוטומטי יומי הופסק', 'warning');
            }
        }

        // ========== Device & Preview Functions ==========
        function setDevice(device) {
            currentDevice = device;
            
            const preview = document.getElementById('websitePreview');
            const buttons = document.querySelectorAll('.device-btn');
            
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-device="${device}"]`).classList.add('active');
            
            preview.className = `website-preview ${device}`;
            
            showNotification('תצוגה', `📱 תצוגה שונתה ל-${device}`, 'success');
        }

        function previewWebsite() {
            if (!currentWebsite) {
                showNotification('שגיאה', '❌ בחר אתר לתצוגה מקדימה', 'error');
                return;
            }
            
            const frame = document.getElementById('previewFrame');
            let content = frame.srcdoc;
            
            if (!content && frame.contentDocument) {
                content = frame.contentDocument.documentElement.outerHTML;
            }
            
            const newWindow = window.open('', '_blank');
            newWindow.document.write(content);
            newWindow.document.close();
            
            showNotification('תצוגה', '👁️ נפתחת תצוגה מקדימה בחלון חדש', 'success');
        }

        function saveWebsite() {
            if (!currentWebsite) {
                showNotification('שגיאה', '❌ בחר אתר לשמירה', 'error');
                return;
            }
            
            setLoadingState(true);
            
            const frame = document.getElementById('previewFrame');
            let content = frame.srcdoc;
            
            if (!content && frame.contentDocument) {
                content = frame.contentDocument.documentElement.outerHTML;
            }
            
            // Save to localStorage
            const saveData = {
                ...currentWebsite,
                content: content,
                lastModified: new Date().toISOString(),
                settings: {
                    colors: {
                        primary: document.getElementById('primaryColor').value,
                        secondary: document.getElementById('secondaryColor').value,
                        background: document.getElementById('backgroundColor').value
                    },
                    typography: {
                        font: document.getElementById('primaryFont').value,
                        headingSize: document.getElementById('headingSize').value,
                        textSize: document.getElementById('textSize').value,
                        fontWeight: document.getElementById('fontWeight').value,
                        lineHeight: document.getElementById('lineHeight').value
                    },
                    animations: {
                        entrance: document.getElementById('entranceAnimation').value,
                        speed: document.getElementById('animationSpeed').value
                    }
                }
            };
            
            localStorage.setItem(`webmaster_website_${currentWebsite.id}`, JSON.stringify(saveData));
            
            setTimeout(() => {
                setLoadingState(false);
                showNotification('שמירה', `💾 ${currentWebsite.name} נשמר בהצלחה!`, 'success');
                updateStatusBar();
                
                // Auto sync to cloud if connected
                if (cloudConnected) {
                    syncToCloud();
                }
            }, 1000);
        }

        // ========== Utility Functions ==========
        function setLoadingState(loading) {
            isLoading = loading;
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            if (loading) {
                indicator.className = 'status-indicator-bar loading';
                statusText.textContent = 'שומר...';
            } else {
                indicator.className = 'status-indicator-bar';
                statusText.textContent = 'מוכן לעריכה';
            }
        }

        function updateStatusBar() {
            const lastSaved = document.getElementById('lastSaved');
            lastSaved.textContent = `עדכון אחרון: ${new Date().toLocaleTimeString('he-IL')}`;
        }

        function showNotification(title, message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            notification.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-text">${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 4000);
        }

        // ========== Event Handlers ==========
        function onElementSelected(element) {
            console.log('Element selected:', element);
            showNotification('בחירה', '🎯 אלמנט נבחר לעריכה', 'success');
        }

        function onContentChanged(element) {
            console.log('Content changed:', element);
            showNotification('עריכה', '✏️ תוכן עודכן', 'success');
            updateStatusBar();
        }

        // ========== Keyboard Shortcuts ==========
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            saveWebsite();
                            break;
                        case 'p':
                            e.preventDefault();
                            previewWebsite();
                            break;
                        case '1':
                            e.preventDefault();
                            switchTab('content');
                            break;
                        case '2':
                            e.preventDefault();
                            switchTab('design');
                            break;
                        case '3':
                            e.preventDefault();
                            switchTab('media');
                            break;
                        case '4':
                            e.preventDefault();
                            switchTab('cloud');
                            break;
                    }
                }
            });
        }

        // ========== Auto-save ==========
        function startAutoSave() {
            setInterval(() => {
                if (currentWebsite && !isLoading) {
                    const autoSaveData = {
                        ...currentWebsite,
                        autoSaved: true,
                        timestamp: new Date().toISOString()
                    };
                    localStorage.setItem(`webmaster_autosave_${currentWebsite.id}`, JSON.stringify(autoSaveData));
                }
            }, 60000); // Auto-save every minute
        }

        // ========== Load Saved Settings ==========
        function loadSavedSettings() {
            // Load cloud credentials
            const savedUrl = localStorage.getItem('supabase_url');
            const savedKey = localStorage.getItem('supabase_key');
            
            if (savedUrl && savedKey) {
                document.getElementById('supabaseUrl').value = savedUrl;
                document.getElementById('supabaseKey').value = savedKey;
            }
            
            // Load design settings if available
            const savedSettings = localStorage.getItem('webmaster_editor_settings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    
                    if (settings.colors) {
                        document.getElementById('primaryColor').value = settings.colors.primary || '#667eea';
                        document.getElementById('secondaryColor').value = settings.colors.secondary || '#764ba2';
                        document.getElementById('backgroundColor').value = settings.colors.background || '#ffffff';
                    }
                    
                    if (settings.typography) {
                        document.getElementById('primaryFont').value = settings.typography.font || 'Assistant';
                        document.getElementById('headingSize').value = settings.typography.headingSize || '48';
                        document.getElementById('textSize').value = settings.typography.textSize || '16';
                        document.getElementById('fontWeight').value = settings.typography.fontWeight || '600';
                        document.getElementById('lineHeight').value = settings.typography.lineHeight || '1.6';
                    }
                    
                } catch (error) {
                    console.error('Error loading saved settings:', error);
                }
            }
        }

        // ========== Export Functions ==========
        function exportWebsite() {
            if (!currentWebsite) {
                showNotification('שגיאה', '❌ בחר אתר לייצוא', 'error');
                return;
            }
            
            const frame = document.getElementById('previewFrame');
            let content = frame.srcdoc;
            
            if (!content && frame.contentDocument) {
                content = frame.contentDocument.documentElement.outerHTML;
            }
            
            // Create clean HTML for export
            const cleanHTML = cleanHTMLForExport(content);
            
            const blob = new Blob([cleanHTML], { type: 'text/html; charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentWebsite.businessName.replace(/[^a-zA-Z0-9\u0590-\u05FF]/g, '_')}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('ייצוא', `📁 ${currentWebsite.name} יוצא כקובץ HTML!`, 'success');
        }

        function cleanHTMLForExport(html) {
            let cleanHTML = html;
            
            // Remove editable classes and data attributes
            cleanHTML = cleanHTML.replace(/class="[^"]*editable[^"]*"/g, '');
            cleanHTML = cleanHTML.replace(/data-element="[^"]*"/g, '');
            cleanHTML = cleanHTML.replace(/contenteditable="[^"]*"/g, '');
            
            // Remove editing scripts
            cleanHTML = cleanHTML.replace(/<script[^>]*>[\s\S]*?selectElement[\s\S]*?<\/script>/gi, '');
            
            // Remove outline styles
            cleanHTML = cleanHTML.replace(/outline:[^;]*;/g, '');
            
            // Add production meta tags
            const productionMeta = `
                <meta name="description" content="אתר מקצועי שנוצר עם WebMaster Pro">
                <meta name="keywords" content="עסק, שירותים, מקצועי">
                <meta name="author" content="WebMaster Pro">
                <meta property="og:type" content="website">
                <meta property="og:title" content="${currentWebsite.businessName || 'אתר מקצועי'}">
                <meta property="og:description" content="אתר מקצועי שנוצר עם WebMaster Pro">
                <!-- WebMaster Pro - Advanced Editor -->
            `;
            
            cleanHTML = cleanHTML.replace('</head>', productionMeta + '</head>');
            
            return cleanHTML;
        }

        // ========== Initialize ==========
        document.addEventListener('DOMContentLoaded', function() {
            initializeEditor();
            loadSavedSettings();
            setupKeyboardShortcuts();
            startAutoSave();
            console.log('🎯 WebMaster Pro Advanced Editor מוכן לפעולה!');
        });

        // Setup global handlers
        window.onElementSelected = onElementSelected;
        window.onContentChanged = onContentChanged;

        // Window unload handler to save settings
        window.addEventListener('beforeunload', function() {
            const settings = {
                colors: {
                    primary: document.getElementById('primaryColor').value,
                    secondary: document.getElementById('secondaryColor').value,
                    background: document.getElementById('backgroundColor').value
                },
                typography: {
                    font: document.getElementById('primaryFont').value,
                    headingSize: document.getElementById('headingSize').value,
                    textSize: document.getElementById('textSize').value,
                    fontWeight: document.getElementById('fontWeight').value,
                    lineHeight: document.getElementById('lineHeight').value
                },
                animations: {
                    entrance: document.getElementById('entranceAnimation').value,
                    speed: document.getElementById('animationSpeed').value
                }
            };
            
            localStorage.setItem('webmaster_editor_settings', JSON.stringify(settings));
        });
    </script>
</body>
</html>
