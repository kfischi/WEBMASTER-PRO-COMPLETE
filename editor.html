<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebMaster Pro - אדיטור מהפכני עם בינה מלאכותית | פיצ'רים ייחודיים</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #0B0F1A;
            --bg-secondary: #131829;
            --bg-tertiary: #1A1F35;
            --accent-neon: #00FFFF;
            --accent-purple: #8B5CF6;
            --accent-gold: #FFD700;
            --text-primary: #FFFFFF;
            --text-secondary: #A0AEC0;
            --glass-bg: rgba(255,255,255,0.05);
            --glass-border: rgba(255,255,255,0.1);
            --shadow-neon: 0 0 20px rgba(0, 255, 255, 0.3);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-neon: linear-gradient(135deg, #00FFFF 0%, #8B5CF6 100%);
        }

        body {
            font-family: 'Heebo', 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow: hidden;
            height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
        }

        /* Advanced Layout System */
        .editor-container {
            display: grid;
            grid-template-columns: 350px 1fr 400px;
            grid-template-rows: 70px 1fr 50px;
            height: 100vh;
            gap: 0;
            position: relative;
        }

        /* Floating Header */
        .floating-header {
            grid-column: 1 / -1;
            background: rgba(11, 15, 26, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 1000;
            position: relative;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: var(--gradient-neon);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5));
        }

        .ai-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--glass-bg);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            border: 1px solid var(--glass-border);
        }

        .ai-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-neon);
            animation: pulse-ai 2s infinite;
        }

        @keyframes pulse-ai {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .action-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .action-btn:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
            box-shadow: var(--shadow-neon);
            transform: translateY(-2px);
        }

        .action-btn.primary {
            background: var(--gradient-neon);
            border: none;
            color: var(--bg-primary);
        }

        /* Left Sidebar - Advanced Tools */
        .left-sidebar {
            background: rgba(19, 24, 41, 0.95);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--glass-border);
            overflow-y: auto;
            position: relative;
        }

        .sidebar-section {
            padding: 1.5rem;
            border-bottom: 1px solid var(--glass-border);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--accent-neon);
        }

        .section-header i {
            font-size: 1.2rem;
        }

        /* Futuristic Website Cards */
        .website-grid {
            display: grid;
            gap: 0.75rem;
        }

        .website-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .website-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .website-card:hover::before {
            left: 100%;
        }

        .website-card:hover {
            border-color: var(--accent-neon);
            box-shadow: 0 5px 25px rgba(0, 255, 255, 0.2);
            transform: translateY(-3px);
        }

        .website-card.active {
            border-color: var(--accent-neon);
            background: rgba(0, 255, 255, 0.1);
            box-shadow: var(--shadow-neon);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .website-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .website-price {
            background: var(--gradient-neon);
            color: var(--bg-primary);
            padding: 0.2rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .website-meta {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .card-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.8rem;
        }

        .status-badge {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            color: var(--accent-neon);
        }

        .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-neon);
        }

        /* Revolutionary AI Panel */
        .ai-panel {
            background: linear-gradient(135deg, rgba(0, 255, 255, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .ai-panel::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent 40%, rgba(0, 255, 255, 0.1) 50%, transparent 60%);
            animation: ai-shimmer 3s infinite;
        }

        @keyframes ai-shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .ai-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 700;
            z-index: 1;
            position: relative;
        }

        .ai-input-group {
            position: relative;
            z-index: 1;
        }

        .ai-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 0.75rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .ai-input:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .ai-input::placeholder {
            color: var(--text-secondary);
        }

        .ai-suggestions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            z-index: 1;
            position: relative;
        }

        .ai-suggestion {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.8rem;
        }

        .ai-suggestion:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
            transform: scale(1.05);
        }

        /* Revolutionary Design Tools */
        .tool-panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .tool-grid {
            display: grid;
            gap: 1rem;
        }

        .tool-group {
            margin-bottom: 1rem;
        }

        .tool-label {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent-neon);
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .color-swatch {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            position: relative;
        }

        .color-swatch:hover {
            border-color: var(--accent-neon);
            transform: scale(1.1);
        }

        .color-swatch.active {
            border-color: var(--accent-neon);
            box-shadow: var(--shadow-neon);
        }

        .advanced-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem;
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .advanced-input:focus {
            outline: none;
            border-color: var(--accent-neon);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
        }

        .slider-group {
            margin: 1rem 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: var(--glass-bg);
            outline: none;
            -webkit-appearance: none;
            margin: 0.5rem 0;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--accent-neon);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .tool-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            min-width: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tool-btn:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
        }

        .tool-btn.active {
            background: var(--accent-neon);
            color: var(--bg-primary);
        }

        /* Center Preview Area */
        .preview-area {
            background: var(--bg-secondary);
            position: relative;
            overflow: hidden;
        }

        .preview-header {
            background: rgba(19, 24, 41, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--glass-border);
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .device-controls {
            display: flex;
            gap: 0.5rem;
        }

        .device-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .device-btn:hover {
            background: var(--accent-neon);
            color: var(--bg-primary);
        }

        .device-btn.active {
            background: var(--accent-neon);
            color: var(--bg-primary);
            box-shadow: var(--shadow-neon);
        }

        .preview-controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .zoom-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .iframe-container {
            position: relative;
            height: calc(100% - 70px);
            background: #fff;
            border-radius: 12px;
            margin: 1rem;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.5s ease;
        }

        .iframe-container.device-desktop {
            width: calc(100% - 2rem);
        }

        .iframe-container.device-tablet {
            width: 768px;
            margin: 1rem auto;
        }

        .iframe-container.device-mobile {
            width: 375px;
            margin: 1rem auto;
        }

        .preview-frame {
            width: 100%;
            height: 100%;
            border: none;
            border-radius: 12px;
        }

        /* Right Sidebar - Advanced Properties */
        .right-sidebar {
            background: rgba(19, 24, 41, 0.95);
            backdrop-filter: blur(20px);
            border-left: 1px solid var(--glass-border);
            overflow-y: auto;
        }

        /* Smart Element Inspector */
        .element-inspector {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .inspector-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--accent-purple);
        }

        .element-path {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 8px;
            padding: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.8rem;
            color: var(--accent-purple);
            margin-bottom: 1rem;
        }

        .property-grid {
            display: grid;
            gap: 1rem;
        }

        .property-group {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 1rem;
        }

        .property-label {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--accent-gold);
        }

        /* Advanced Media Manager */
        .media-manager {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .upload-zone {
            border: 2px dashed var(--glass-border);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .upload-zone:hover {
            border-color: var(--accent-neon);
            background: rgba(0, 255, 255, 0.05);
        }

        .upload-zone.dragover {
            border-color: var(--accent-neon);
            background: rgba(0, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
        }

        .media-item {
            aspect-ratio: 1;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .media-item:hover {
            border-color: var(--accent-neon);
            transform: scale(1.05);
        }

        .media-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Collaborative Features */
        .collaboration-panel {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(139, 92, 246, 0.1) 100%);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .collab-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
            font-weight: 600;
            color: var(--accent-gold);
        }

        .user-avatars {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-neon);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.8rem;
            color: var(--bg-primary);
            border: 2px solid var(--accent-neon);
        }

        .activity-feed {
            max-height: 150px;
            overflow-y: auto;
        }

        .activity-item {
            padding: 0.5rem;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            background: rgba(255, 255, 255, 0.02);
        }

        /* Footer Status Bar */
        .status-footer {
            grid-column: 1 / -1;
            background: rgba(11, 15, 26, 0.95);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--glass-border);
            padding: 0.75rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
        }

        .status-left {
            display: flex;
            gap: 2rem;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .status-indicator.online {
            background: var(--accent-neon);
            box-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .status-indicator.saving {
            background: var(--accent-gold);
            animation: pulse-save 1s infinite;
        }

        @keyframes pulse-save {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .status-right {
            display: flex;
            gap: 1rem;
            align-items: center;
            color: var(--text-secondary);
        }

        /* Responsive Design */
        @media (max-width: 1400px) {
            .editor-container {
                grid-template-columns: 300px 1fr 350px;
            }
        }

        @media (max-width: 1200px) {
            .editor-container {
                grid-template-columns: 280px 1fr 320px;
            }
        }

        @media (max-width: 768px) {
            .editor-container {
                grid-template-columns: 1fr;
                grid-template-rows: 70px 1fr 50px;
            }
            
            .left-sidebar,
            .right-sidebar {
                display: none;
            }
            
            .left-sidebar.mobile-open,
            .right-sidebar.mobile-open {
                display: block;
                position: absolute;
                top: 70px;
                bottom: 50px;
                z-index: 1000;
                width: 320px;
            }
            
            .left-sidebar.mobile-open {
                left: 0;
            }
            
            .right-sidebar.mobile-open {
                right: 0;
            }
        }

        /* Loading States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--glass-border);
            border-top: 3px solid var(--accent-neon);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 0.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            z-index: 10000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            max-width: 400px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: var(--accent-neon);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .notification.error {
            border-color: #ff4757;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.2);
        }

        .notification.warning {
            border-color: var(--accent-gold);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.2);
        }

        /* Custom Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--accent-neon);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #00E6E6;
        }
    </style>
</head>
<body>
    <!-- Main Editor Container -->
    <div class="editor-container">
        <!-- Floating Header -->
        <header class="floating-header">
            <div class="logo-section">
                <div class="logo">
                    <i class="fas fa-magic"></i>
                    WebMaster Pro
                </div>
                <div class="ai-status">
                    <div class="ai-indicator"></div>
                    <span>AI Active</span>
                </div>
            </div>
            
            <div class="header-actions">
                <select id="websiteSelector" class="advanced-input" style="width: 200px;">
                    <option value="">בחר אתר לעריכה...</option>
                </select>
                
                <button class="action-btn" onclick="loadDemoWebsite()">
                    <i class="fas fa-rocket"></i>
                    דמו מהיר
                </button>
                
                <button class="action-btn" onclick="togglePreview()">
                    <i class="fas fa-eye"></i>
                    תצוגה מקדימה
                </button>
                
                <button class="action-btn" onclick="saveProject()">
                    <i class="fas fa-save"></i>
                    שמור פרויקט
                </button>
                
                <button class="action-btn primary" onclick="exportProject()">
                    <i class="fas fa-download"></i>
                    ייצא מוכן
                </button>
            </div>
        </header>

        <!-- Left Sidebar - Advanced Tools -->
        <aside class="left-sidebar">
            <!-- Website Gallery -->
            <section class="sidebar-section">
                <div class="section-header">
                    <i class="fas fa-globe-americas"></i>
                    <span>האתרים שלי (11)</span>
                </div>
                <div class="website-grid" id="websiteGrid">
                    <!-- Dynamic content -->
                </div>
            </section>

            <!-- Revolutionary AI Assistant -->
            <section class="sidebar-section">
                <div class="ai-panel">
                    <div class="ai-header">
                        <i class="fas fa-robot"></i>
                        <span>עוזר AI מהפכני</span>
                    </div>
                    
                    <div class="ai-input-group">
                        <input type="text" class="ai-input" id="aiInput" 
                               placeholder="שאל אותי כל שאלה על עיצוב, תוכן או קוד...">
                        <button class="action-btn primary" onclick="processAIRequest()" style="width: 100%;">
                            <i class="fas fa-paper-plane"></i>
                            שלח ל-AI
                        </button>
                    </div>
                    
                    <div class="ai-suggestions">
                        <div class="ai-suggestion" onclick="runAICommand('optimize-design')">
                            אופטימיזציה אוטומטית
                        </div>
                        <div class="ai-suggestion" onclick="runAICommand('generate-content')">
                            יצירת תוכן חכם
                        </div>
                        <div class="ai-suggestion" onclick="runAICommand('improve-seo')">
                            שיפור SEO מתקדם
                        </div>
                        <div class="ai-suggestion" onclick="runAICommand('color-harmony')">
                            התאמת צבעים AI
                        </div>
                    </div>
                </div>
            </section>

            <!-- Advanced Design Tools -->
            <section class="sidebar-section">
                <div class="tool-panel">
                    <div class="section-header">
                        <i class="fas fa-palette"></i>
                        <span>כלי עיצוב מתקדמים</span>
                    </div>
                    
                    <div class="tool-grid">
                        <div class="tool-group">
                            <div class="tool-label">פלטת צבעים חכמה</div>
                            <div class="color-palette" id="colorPalette">
                                <!-- Dynamic colors -->
                            </div>
                            <button class="action-btn" onclick="generateColorPalette()" style="width: 100%;">
                                <i class="fas fa-wand-magic-sparkles"></i>
                                צור פלטה חדשה
                            </button>
                        </div>

                        <div class="tool-group">
                            <div class="tool-label">טיפוגרפיה אינטליגנטית</div>
                            <select class="advanced-input" id="fontFamily" onchange="updateTypography()">
                                <option value="Heebo">Heebo - עברית מותאמת</option>
                                <option value="Inter">Inter - אנגלית מודרנית</option>
                                <option value="Assistant">Assistant - היברידי</option>
                                <option value="Rubik">Rubik - עיצוב מודרני</option>
                            </select>
                            
                            <div class="slider-group">
                                <label class="tool-label">גודל פונט: <span id="fontSizeValue">16px</span></label>
                                <input type="range" class="slider" id="fontSizeSlider" 
                                       min="12" max="32" value="16" onchange="updateFontSize(this.value)">
                            </div>
                            
                            <div class="slider-group">
                                <label class="tool-label">מרווח שורות: <span id="lineHeightValue">1.6</span></label>
                                <input type="range" class="slider" id="lineHeightSlider" 
                                       min="1.2" max="2.5" step="0.1" value="1.6" onchange="updateLineHeight(this.value)">
                            </div>
                        </div>

                        <div class="tool-group">
                            <div class="tool-label">עיצוב אלמנטים</div>
                            <div class="button-group">
                                <button class="tool-btn" onclick="setElementStyle('rounded')" title="מעוגל">
                                    <i class="fas fa-circle"></i>
                                </button>
                                <button class="tool-btn" onclick="setElementStyle('sharp')" title="חד">
                                    <i class="fas fa-square"></i>
                                </button>
                                <button class="tool-btn" onclick="setElementStyle('gradient')" title="גרדיאנט">
                                    <i class="fas fa-paint-brush"></i>
                                </button>
                                <button class="tool-btn" onclick="setElementStyle('glass')" title="זכוכית">
                                    <i class="fas fa-gem"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Layout Revolution -->
            <section class="sidebar-section">
                <div class="tool-panel">
                    <div class="section-header">
                        <i class="fas fa-th-large"></i>
                        <span>פריסה מהפכנית</span>
                    </div>
                    
                    <div class="tool-group">
                        <div class="tool-label">הוסף סקציות חכמות</div>
                        <div class="button-group">
                            <button class="action-btn" onclick="addSmartSection('hero')" style="width: 100%; margin-bottom: 0.5rem;">
                                <i class="fas fa-star"></i>
                                Hero מותאם
                            </button>
                            <button class="action-btn" onclick="addSmartSection('services')" style="width: 100%; margin-bottom: 0.5rem;">
                                <i class="fas fa-concierge-bell"></i>
                                שירותים חכמים
                            </button>
                            <button class="action-btn" onclick="addSmartSection('testimonials')" style="width: 100%; margin-bottom: 0.5rem;">
                                <i class="fas fa-quote-right"></i>
                                המלצות AI
                            </button>
                            <button class="action-btn" onclick="addSmartSection('contact')" style="width: 100%;">
                                <i class="fas fa-address-book"></i>
                                צור קשר מתקדם
                            </button>
                        </div>
                    </div>

                    <div class="tool-group">
                        <div class="tool-label">מערכת עמודות חכמה</div>
                        <div class="button-group">
                            <button class="tool-btn" onclick="setSmartColumns(1)" title="עמודה אחת">1</button>
                            <button class="tool-btn" onclick="setSmartColumns(2)" title="2 עמודות">2</button>
                            <button class="tool-btn" onclick="setSmartColumns(3)" title="3 עמודות">3</button>
                            <button class="tool-btn" onclick="setSmartColumns(4)" title="4 עמודות">4</button>
                            <button class="tool-btn" onclick="setSmartColumns('auto')" title="אוטומטי">
                                <i class="fas fa-magic"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </aside>

        <!-- Center Preview Area -->
        <main class="preview-area">
            <div class="preview-header">
                <div class="device-controls">
                    <button class="device-btn active" onclick="setDevice('desktop')" data-device="desktop">
                        <i class="fas fa-desktop"></i>
                        <span>Desktop</span>
                    </button>
                    <button class="device-btn" onclick="setDevice('tablet')" data-device="tablet">
                        <i class="fas fa-tablet-alt"></i>
                        <span>Tablet</span>
                    </button>
                    <button class="device-btn" onclick="setDevice('mobile')" data-device="mobile">
                        <i class="fas fa-mobile-alt"></i>
                        <span>Mobile</span>
                    </button>
                </div>
                
                <div class="preview-controls">
                    <div class="zoom-control">
                        <i class="fas fa-search-minus"></i>
                        <input type="range" class="slider" id="zoomSlider" 
                               min="50" max="200" value="100" onchange="updateZoom(this.value)">
                        <i class="fas fa-search-plus"></i>
                        <span id="zoomValue">100%</span>
                    </div>
                    
                    <button class="action-btn" onclick="refreshPreview()">
                        <i class="fas fa-redo"></i>
                    </button>
                </div>
            </div>
            
            <div class="iframe-container device-desktop" id="iframeContainer">
                <iframe id="previewFrame" class="preview-frame" src="about:blank"></iframe>
            </div>
        </main>

        <!-- Right Sidebar - Advanced Properties -->
        <aside class="right-sidebar">
            <!-- Smart Element Inspector -->
            <section class="sidebar-section">
                <div class="element-inspector">
                    <div class="inspector-header">
                        <i class="fas fa-search"></i>
                        <span>בדיקת אלמנטים חכמה</span>
                    </div>
                    
                    <div class="element-path" id="elementPath">
                        בחר אלמנט לבדיקה...
                    </div>
                    
                    <div class="property-grid" id="propertyGrid">
                        <div class="loading">
                            <span>בחר אלמנט לעריכה</span>
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Advanced Media Manager -->
            <section class="sidebar-section">
                <div class="media-manager">
                    <div class="section-header">
                        <i class="fas fa-images"></i>
                        <span>ניהול מדיה מתקדם</span>
                    </div>
                    
                    <div class="upload-zone" id="uploadZone">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--accent-neon);"></i>
                        <div>גרור קבצים או לחץ להעלאה</div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            תמיכה: JPG, PNG, WebP, SVG
                        </div>
                    </div>
                    
                    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                    
                    <div class="media-grid" id="mediaGrid">
                        <!-- Dynamic media items -->
                    </div>
                    
                    <button class="action-btn" onclick="optimizeImages()" style="width: 100%; margin-top: 1rem;">
                        <i class="fas fa-compress-alt"></i>
                        אופטימיזציה אוטומטית
                    </button>
                </div>
            </section>

            <!-- Collaborative Features -->
            <section class="sidebar-section">
                <div class="collaboration-panel">
                    <div class="collab-header">
                        <i class="fas fa-users"></i>
                        <span>עבודה שיתופית</span>
                    </div>
                    
                    <div class="user-avatars" id="userAvatars">
                        <div class="user-avatar">אני</div>
                    </div>
                    
                    <button class="action-btn" onclick="inviteCollaborator()" style="width: 100%; margin-bottom: 1rem;">
                        <i class="fas fa-user-plus"></i>
                        הזמן משתתפים
                    </button>
                    
                    <div class="activity-feed" id="activityFeed">
                        <div class="activity-item">
                            <i class="fas fa-clock" style="margin-left: 0.5rem;"></i>
                            פרויקט נוצר בהצלחה
                        </div>
                    </div>
                </div>
            </section>

            <!-- Advanced Settings -->
            <section class="sidebar-section">
                <div class="tool-panel">
                    <div class="section-header">
                        <i class="fas fa-cogs"></i>
                        <span>הגדרות מתקדמות</span>
                    </div>
                    
                    <div class="tool-group">
                        <div class="tool-label">SEO אוטומטי</div>
                        <input type="text" class="advanced-input" id="seoTitle" placeholder="כותרת אוטומטית...">
                        <textarea class="advanced-input" id="seoDescription" placeholder="תיאור אוטומטי..." rows="3" style="margin-top: 0.5rem;"></textarea>
                        <button class="action-btn" onclick="generateSEO()" style="width: 100%; margin-top: 0.5rem;">
                            <i class="fas fa-robot"></i>
                            יצירה אוטומטית
                        </button>
                    </div>

                    <div class="tool-group">
                        <div class="tool-label">אנימציות חכמות</div>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="checkbox" id="enableAnimations" checked onchange="toggleAnimations()">
                            <span>אנימציות מתקדמות</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                            <input type="checkbox" id="enableParallax" onchange="toggleParallax()">
                            <span>אפקט Parallax</span>
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="enableMicroInteractions" checked onchange="toggleMicroInteractions()">
                            <span>מיקרו אינטראקציות</span>
                        </label>
                    </div>

                    <div class="tool-group">
                        <div class="tool-label">ביצועים מתקדמים</div>
                        <button class="action-btn" onclick="runPerformanceAudit()" style="width: 100%; margin-bottom: 0.5rem;">
                            <i class="fas fa-tachometer-alt"></i>
                            בדיקת ביצועים
                        </button>
                        <button class="action-btn" onclick="optimizeForSpeed()" style="width: 100%;">
                            <i class="fas fa-rocket"></i>
                            אופטימיזציה לטעינה
                        </button>
                    </div>
                </div>
            </section>
        </aside>

        <!-- Status Footer -->
        <footer class="status-footer">
            <div class="status-left">
                <div class="status-item">
                    <div class="status-indicator online"></div>
                    <span>מחובר</span>
                </div>
                <div class="status-item">
                    <div class="status-indicator saving"></div>
                    <span>שמירה אוטומטית</span>
                </div>
                <div class="status-item">
                    <i class="fas fa-users"></i>
                    <span>1 משתמש פעיל</span>
                </div>
            </div>
            
            <div class="status-right">
                <div class="status-item">
                    <i class="fas fa-clock"></i>
                    <span id="currentTime"></span>
                </div>
                <div class="status-item">
                    <i class="fas fa-code"></i>
                    <span>WebMaster Pro v3.0</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Revolutionary Website Data - Exact from your project
        const websiteDatabase = {
            'aesthetic-clinic': {
                id: 'aesthetic-clinic',
                name: 'קליניקת יופי פרמיום',
                category: 'אסתטיקה רפואית',
                price: '₪3,200',
                status: 'מוכן למכירה',
                primaryColor: '#8B5CF6',
                description: 'קליניקת יופי יוקרתית עם טיפולים מתקדמים',
                features: ['בוטוקס', 'חומצה היאלורונית', 'לייזר', 'פילינג כימי', 'טיפולי עור', 'יעוץ אסתטי'],
                revenue: 3200,
                difficulty: 'מתקדם'
            },
            'dr-michal-rosen': {
                id: 'dr-michal-rosen',
                name: 'ד"ר מיכל רוזן',
                category: 'רפואה אסתטית',
                price: '₪2,800',
                status: 'מוכן למכירה',
                primaryColor: '#EC4899',
                description: 'מומחית ברפואה אסתטית וטיפולי יופי',
                features: ['רפואה אסתטית', 'טיפולי בוטוקס', 'מילוי קמטים', 'יעוץ יופי', 'טיפולי עור', 'ליווי אישי'],
                revenue: 2800,
                difficulty: 'בינוני'
            },
            'real-estate': {
                id: 'real-estate',
                name: 'נדל"ן פרמיום',
                category: 'נדל"ן יוקרתי',
                price: '₪2,700',
                status: 'מוכן למכירה',
                primaryColor: '#059669',
                description: 'משרד תיווך נדל"ן יוקרתי ומקצועי',
                features: ['דירות יוקרה', 'בתים פרטיים', 'נכסי השקעה', 'יעוץ נדל"ן', 'הערכות שווי', 'ליווי משפטי'],
                revenue: 2700,
                difficulty: 'בינוני'
            },
            'law-firm': {
                id: 'law-firm',
                name: 'משרד ברקוביץ',
                category: 'עורכי דין',
                price: '₪2,500',
                status: 'מוכן למכירה',
                primaryColor: '#6B7280',
                description: 'משרד עורכי דין מקצועי ומנוסה',
                features: ['דיני משפחה', 'דיני נזיקין', 'דיני חברות', 'דיני עבודה', 'דיני נדל"ן', 'ליטיגציה'],
                revenue: 2500,
                difficulty: 'מתקדם'
            },
            'nutritionist': {
                id: 'nutritionist',
                name: 'ד"ר שרה כהן',
                category: 'תזונה קלינית',
                price: '₪2,400',
                status: 'מוכן למכירה',
                primaryColor: '#10B981',
                description: 'תזונאית קלינית מומחית ומנוסה',
                features: ['תפריטים אישיים', 'ירידה במשקל', 'תזונה ספורטיבית', 'תזונה טיפולית', 'ליווי תזונתי', 'סדנאות'],
                revenue: 2400,
                difficulty: 'בסיסי'
            },
            'multibrawn': {
                id: 'multibrawn',
                name: 'מולטיבראון',
                category: 'נופש ואירועים',
                price: '₪2,300',
                status: 'מוכן למכירה',
                primaryColor: '#3B82F6',
                description: 'אתר נופש ואירועים מרהיב ויוקרתי',
                features: ['חתונות', 'בר מצווה', 'אירועי חברה', 'כנסים', 'נופש משפחתי', 'קייטרינג'],
                revenue: 2300,
                difficulty: 'מתקדם'
            },
            'fitness-co': {
                id: 'fitness-co',
                name: 'דני פיט',
                category: 'כושר ואימונים',
                price: '₪2,200',
                status: 'מוכן למכירה',
                primaryColor: '#EF4444',
                description: 'מאמן כושר אישי מקצועי ומנוסה',
                features: ['אימון אישי', 'תוכניות כושר', 'ייעוץ תזונתי', 'אימוני קבוצה', 'פילאטיס', 'יוגה'],
                revenue: 2200,
                difficulty: 'בסיסי'
            },
            'tutor': {
                id: 'tutor',
                name: 'ד"ר רונית לוי',
                category: 'חינוך ולימודים',
                price: '₪2,100',
                status: 'מוכן למכירה',
                primaryColor: '#8B5CF6',
                description: 'מורה פרטית ויועצת חינוכית מנוסה',
                features: ['מתמטיקה', 'אנגלית', 'פיזיקה', 'כימיה', 'הכנה לבגרות', 'יעוץ לימודי'],
                revenue: 2100,
                difficulty: 'בסיסי'
            },
            'accountant': {
                id: 'accountant',
                name: 'רינה לוי CPA',
                category: 'חשבונאות ומיסים',
                price: '₪2,000',
                status: 'מוכן למכירה',
                primaryColor: '#3B82F6',
                description: 'רואת חשבון מוסמכת ומנוסה',
                features: ['הנהלת חשבונות', 'דוחות כספיים', 'ייעוץ מס', 'שכר עובדים', 'ביקורת', 'הקמת עסקים'],
                revenue: 2000,
                difficulty: 'בינוני'
            },
            'yoga-studio': {
                id: 'yoga-studio',
                name: 'סטודיו אוהם',
                category: 'יוגה ומדיטציה',
                price: '₪1,900',
                status: 'מוכן למכירה',
                primaryColor: '#10B981',
                description: 'סטודיו יוגה ומדיטציה מקצועי',
                features: ['יוגה למתחילים', 'יוגה מתקדמת', 'מדיטציה', 'פילאטיס', 'סדנאות', 'נסיגות'],
                revenue: 1900,
                difficulty: 'בסיסי'
            },
            'beauty-salon': {
                id: 'beauty-salon',
                name: 'מספרה BELLA',
                category: 'יופי ומספרות',
                price: '₪1,700',
                status: 'מוכן למכירה',
                primaryColor: '#EC4899',
                description: 'מספרה ויופי מקצועית ומודרנית',
                features: ['תספורות', 'צביעות', 'טיפולי שיער', 'איפור', 'עיצוב גבות', 'מניקור פדיקור'],
                revenue: 1700,
                difficulty: 'בסיסי'
            }
        };

        // Global State Management
        let currentWebsite = null;
        let currentDevice = 'desktop';
        let selectedElement = null;
        let isAISaving = false;
        let collaborators = [];
        let mediaFiles = [];
        let undoStack = [];
        let redoStack = [];

        // Initialize Revolutionary Editor - with complete error handling
        document.addEventListener('DOMContentLoaded', function() {
            try {
                console.log('Starting WebMaster Pro initialization...');
                initializeEditor();
                startRealTimeFeatures();
                setupAdvancedEventListeners();
                loadSavedState();
                console.log('WebMaster Pro initialized successfully!');
            } catch (error) {
                console.error('Initialization error:', error);
                alert('שגיאה באתחול המערכת. אנא רענן את הדף.');
            }
        });

        function initializeEditor() {
            try {
                console.log('🚀 Starting editor initialization...');
                
                console.log('📱 Loading website gallery...');
                loadWebsiteGallery();
                
                console.log('🔄 Populating website selector...');
                populateWebsiteSelector();
                
                console.log('🎨 Initializing color palette...');
                initializeColorPalette();
                
                console.log('📁 Initializing media manager...');
                initializeMediaManager();
                
                console.log('⏰ Starting time update...');
                startTimeUpdate();
                
                console.log('👋 Showing welcome notification...');
                showWelcomeNotification();
                
                console.log('✅ Editor initialization completed successfully');
                
                // Validate critical elements
                const validation = validateEditorState();
                if (validation) {
                    console.log('✅ All critical elements found and ready');
                    showNotification('success', 'WebMaster Pro הותחל בהצלחה!');
                } else {
                    console.warn('⚠️ Some elements missing - editor may not work properly');
                }
                
            } catch (error) {
                console.error('❌ Editor initialization failed:', error);
                showNotification('error', 'שגיאה באתחול האדיטור: ' + error.message);
            }
        }

        function loadWebsiteGallery() {
            try {
                const websiteGrid = document.getElementById('websiteGrid');
                if (!websiteGrid) {
                    console.warn('Website grid not found');
                    return;
                }
                
                websiteGrid.innerHTML = '';

                Object.values(websiteDatabase).forEach(website => {
                    const websiteCard = createWebsiteCard(website);
                    websiteGrid.appendChild(websiteCard);
                });
                
                console.log('Website gallery loaded successfully');
            } catch (error) {
                console.error('Failed to load website gallery:', error);
                showNotification('error', 'שגיאה בטעינת גלריית האתרים');
            }
        }

        function createWebsiteCard(website) {
            const card = document.createElement('div');
            card.className = 'website-card';
            card.setAttribute('data-website-id', website.id);
            
            // Make sure the click handler is properly bound
            card.addEventListener('click', function() {
                loadWebsite(website);
            });
            
            card.innerHTML = `
                <div class="card-header">
                    <div class="website-name">${website.name}</div>
                    <div class="website-price">${website.price}</div>
                </div>
                <div class="website-meta">${website.category}</div>
                <div class="card-footer">
                    <div class="status-badge">
                        <div class="status-dot"></div>
                        <span>${website.status}</span>
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-secondary);">
                        ${website.difficulty}
                    </div>
                </div>
            `;
            
            return card;
        }

        function populateWebsiteSelector() {
            const selector = document.getElementById('websiteSelector');
            selector.innerHTML = '<option value="">בחר אתר לעריכה...</option>';
            
            Object.values(websiteDatabase).forEach(website => {
                const option = document.createElement('option');
                option.value = website.id;
                option.textContent = `${website.name} - ${website.category}`;
                selector.appendChild(option);
            });
            
            selector.addEventListener('change', function() {
                if (this.value) {
                    const website = websiteDatabase[this.value];
                    if (website) loadWebsite(website);
                }
            });
        }

        function loadWebsite(website) {
            console.log('Loading website:', website.name);
            currentWebsite = website;
            
            // Update UI state immediately
            updateActiveCard(website.id);
            updateWebsiteSelector(website.id);
            
            // Show loading notification
            showNotification('info', `טוען את אתר ${website.name}...`);
            
            // Generate and load website content
            try {
                const websiteHTML = generateAdvancedWebsiteHTML(website);
                console.log('Generated HTML for:', website.name);
                
                // Load website in frame
                const frame = document.getElementById('previewFrame');
                if (!frame) {
                    console.error('Preview frame not found!');
                    showNotification('error', 'שגיאה: לא נמצא אלמנט התצוגה');
                    return;
                }
                
                // Create blob URL and load
                const blob = new Blob([websiteHTML], { type: 'text/html; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                frame.onload = function() {
                    console.log('Website loaded in frame');
                    setupFrameCommunication();
                    URL.revokeObjectURL(url);
                    
                    // Success feedback
                    showNotification('success', `האתר "${website.name}" נטען בהצלחה!`);
                    addActivity(`נטען אתר: ${website.name}`);
                    
                    // Update tools
                    updateColorPalette(website.primaryColor);
                    updateElementInspector(null);
                };
                
                frame.onerror = function() {
                    console.error('Failed to load website in frame');
                    showNotification('error', 'שגיאה בטעינת האתר');
                };
                
                frame.src = url;
                
                // Save state
                saveCurrentState();
                
            } catch (error) {
                console.error('Error loading website:', error);
                showNotification('error', 'שגיאה ביצירת האתר: ' + error.message);
            }
        }

        function generateAdvancedWebsiteHTML(website) {
            const colorScheme = generateColorScheme(website.primaryColor);
            
            // Generate unique content based on website type
            const websiteContent = generateWebsiteContent(website);
            
            return `<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${website.name} - ${website.category}</title>
    <meta name="description" content="${website.description}">
    <meta name="keywords" content="${website.features.join(', ')}">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary: ${colorScheme.primary};
            --secondary: ${colorScheme.secondary};
            --accent: ${colorScheme.accent};
            --background: ${colorScheme.background};
            --surface: ${colorScheme.surface};
            --text-primary: ${colorScheme.textPrimary};
            --text-secondary: ${colorScheme.textSecondary};
            --gradient-primary: linear-gradient(135deg, ${colorScheme.primary} 0%, ${colorScheme.secondary} 100%);
            --shadow: 0 10px 40px rgba(0,0,0,0.1);
            --glass-bg: rgba(255,255,255,0.1);
            --glass-border: rgba(255,255,255,0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Heebo', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background: var(--background);
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Advanced Header */
        .header {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid var(--glass-border);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        [data-editable="true"] {
            position: relative;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
            padding: 2px;
        }

        [data-editable="true"]:hover {
            outline: 2px dashed var(--primary);
            outline-offset: 2px;
            background: rgba(0,0,0,0.02);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, 
                ${colorScheme.primary}10 0%, 
                ${colorScheme.secondary}10 50%, 
                ${colorScheme.accent}10 100%);
            padding: 5rem 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero h1 {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
            color: var(--text-secondary);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-button {
            background: var(--gradient-primary);
            color: white;
            padding: 1.2rem 3rem;
            border: none;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }

        /* Services Section */
        .services {
            padding: 6rem 0;
            background: var(--surface);
        }

        .section-title {
            text-align: center;
            font-size: 2.8rem;
            font-weight: 800;
            margin-bottom: 4rem;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .service-card {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: all 0.3s ease;
            border: 1px solid var(--glass-border);
        }

        .service-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
        }

        .service-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .service-card h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .service-card p {
            color: var(--text-secondary);
            line-height: 1.8;
            margin-bottom: 1.5rem;
        }

        /* Contact Section */
        .contact {
            padding: 6rem 0;
            background: var(--surface);
        }

        .contact-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: start;
        }

        .contact-info {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: var(--shadow);
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding: 1rem;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .contact-item:hover {
            background: var(--glass-bg);
        }

        .contact-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.2rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 { font-size: 2.5rem; }
            .services-grid { grid-template-columns: 1fr; }
            .contact-grid { grid-template-columns: 1fr; gap: 2rem; }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <nav class="nav">
                <div class="logo" data-editable="true">${website.name}</div>
                <div style="display: flex; gap: 2rem;">
                    <a href="#services" style="text-decoration: none; color: var(--text-primary);">שירותים</a>
                    <a href="#contact" style="text-decoration: none; color: var(--text-primary);">צור קשר</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero" id="home">
        <div class="container">
            <h1 data-editable="true">${websiteContent.heroTitle}</h1>
            <p data-editable="true">${websiteContent.heroDescription}</p>
            <a href="#contact" class="cta-button">
                <i class="fas fa-phone"></i>
                צור קשר עכשיו
            </a>
        </div>
    </section>

    <!-- Services Section -->
    <section class="services" id="services">
        <div class="container">
            <h2 class="section-title" data-editable="true">השירותים שלנו</h2>
            <div class="services-grid">
                ${website.features.slice(0, 6).map((feature, index) => `
                    <div class="service-card">
                        <div class="service-icon">
                            <i class="fas fa-${getServiceIcon(feature)}"></i>
                        </div>
                        <h3 data-editable="true">${feature}</h3>
                        <p data-editable="true">${websiteContent.serviceDescriptions[index] || 'שירות מקצועי ואמין ברמה הגבוהה ביותר'}</p>
                    </div>
                `).join('')}
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section class="contact" id="contact">
        <div class="container">
            <div class="contact-grid">
                <div class="contact-info">
                    <h2 data-editable="true">צור קשר</h2>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div>
                            <strong data-editable="true">טלפון</strong><br>
                            <span data-editable="true">${websiteContent.phone}</span>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div>
                            <strong data-editable="true">אימייל</strong><br>
                            <span data-editable="true">${websiteContent.email}</span>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div>
                            <strong data-editable="true">כתובת</strong><br>
                            <span data-editable="true">${websiteContent.address}</span>
                        </div>
                    </div>

                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div>
                            <strong data-editable="true">שעות פעילות</strong><br>
                            <span data-editable="true">${websiteContent.hours}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: white; padding: 3rem; border-radius: 20px; box-shadow: var(--shadow);">
                    <h3 data-editable="true">שלח הודעה</h3>
                    <form style="margin-top: 2rem;">
                        <div style="margin-bottom: 1rem;">
                            <input type="text" placeholder="שם מלא" required style="width: 100%; padding: 1rem; border: 2px solid #eee; border-radius: 10px; font-size: 1rem;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <input type="email" placeholder="אימייל" required style="width: 100%; padding: 1rem; border: 2px solid #eee; border-radius: 10px; font-size: 1rem;">
                        </div>
                        <div style="margin-bottom: 1rem;">
                            <textarea placeholder="הודעה" rows="4" required style="width: 100%; padding: 1rem; border: 2px solid #eee; border-radius: 10px; font-size: 1rem; resize: vertical;"></textarea>
                        </div>
                        <button type="submit" style="background: var(--gradient-primary); color: white; padding: 1rem 2rem; border: none; border-radius: 25px; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%;">
                            שלח הודעה
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </section>

    <script>
        console.log('${website.name} loaded successfully');
        
        // Setup smooth scrolling
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
        
        // Handle form submission
        document.querySelector('form').addEventListener('submit', function(e) {
            e.preventDefault();
            alert('ההודעה נשלחה בהצלחה! נחזור אליך בהקדם.');
            this.reset();
        });
    </script>
</body>
</html>`;
        }

        function generateWebsiteContent(website) {
            const contentTemplates = {
                'aesthetic-clinic': {
                    heroTitle: 'מרכז היופי הפרמיום המוביל בישראל',
                    heroDescription: 'טיפולי יופי ואסתטיקה מתקדמים עם טכנולוגיה חדשנית ומומחיות ברמה עולמית',
                    phone: '03-555-0123',
                    email: 'info@beauty-premium.co.il',
                    address: 'רחוב הירקון 125, תל אביב',
                    hours: 'ראשון-חמישי 9:00-20:00, שישי 9:00-14:00',
                    serviceDescriptions: [
                        'טיפולי בוטוקס מתקדמים ובטוחים עם מומחית מובילה',
                        'חומצה היאלורונית איכותית למראה צעיר וטבעי',
                        'טיפולי לייזר חדשניים לכל סוגי העור',
                        'פילינג כימי עמוק לחידוש העור',
                        'טיפולי פנים מקצועיים ומותאמים אישית',
                        'ייעוץ אסתטי מקצועי וליווי אישי'
                    ]
                },
                'dr-michal-rosen': {
                    heroTitle: 'ד"ר מיכל רוזן - רפואה אסתטית ברמה עולמית',
                    heroDescription: 'מומחיות רפואית מובילה בטיפולי יופי וחידוש עם ליווי אישי מלא',
                    phone: '03-555-0456',
                    email: 'dr.rosen@clinic.co.il',
                    address: 'שדרות רוטשילד 45, תל אביב',
                    hours: 'ראשון-רביעי 10:00-19:00, חמישי 10:00-15:00',
                    serviceDescriptions: [
                        'רפואה אסתטית מתקדמת עם גישה אישית',
                        'טיפולי בוטוקס רפואיים ברמה גבוהה',
                        'מילוי קמטים טבעי ומקצועי',
                        'ייעוץ יופי מותאם אישית',
                        'טיפולי עור מתקדמים ובטוחים',
                        'ליווי אישי לכל השלבים'
                    ]
                },
                'default': {
                    heroTitle: `ברוכים הבאים ל${website.name}`,
                    heroDescription: `${website.description} - שירות מקצועי ברמה הגבוהה ביותר`,
                    phone: '03-555-' + Math.floor(Math.random() * 9000 + 1000),
                    email: `info@${website.id}.co.il`,
                    address: 'רחוב הדקל 15, תל אביב',
                    hours: 'ראשון-חמישי 9:00-18:00',
                    serviceDescriptions: website.features.map(feature => 
                        `שירות מקצועי ב${feature} ברמה הגבוהה ביותר עם ניסיון רב שנים`
                    )
                }
            };
            
            return contentTemplates[website.id] || contentTemplates.default;
        }

        function generateColorScheme(primaryColor) {
            // Advanced color generation algorithm
            const hsl = hexToHSL(primaryColor);
            
            return {
                primary: primaryColor,
                secondary: HSLToHex((hsl.h + 30) % 360, hsl.s, Math.max(hsl.l - 10, 10)),
                accent: HSLToHex((hsl.h + 60) % 360, hsl.s, Math.min(hsl.l + 10, 90)),
                background: '#FFFFFF',
                surface: '#F8F9FA',
                textPrimary: '#2D3748',
                textSecondary: '#718096'
            };
        }

        function getServiceIcon(service) {
            const iconMap = {
                'בוטוקס': 'syringe',
                'חומצה היאלורונית': 'tint',
                'לייזר': 'bolt',
                'פילינג כימי': 'spa',
                'טיפולי עור': 'hand-sparkles',
                'יעוץ אסתטי': 'user-md',
                'רפואה אסתטית': 'stethoscope',
                'טיפולי בוטוקס': 'syringe',
                'מילוי קמטים': 'magic',
                'יעוץ יופי': 'heart',
                'ליווי אישי': 'hands-helping',
                'דירות יוקרה': 'home',
                'בתים פרטיים': 'house-user',
                'נכסי השקעה': 'chart-line',
                'יעוץ נדל"ן': 'handshake',
                'הערכות שווי': 'calculator',
                'ליווי משפטי': 'balance-scale',
                'default': 'star'
            };
            return iconMap[service] || iconMap.default;
        }

        function loadWebsiteInFrame(html) {
            const frame = document.getElementById('previewFrame');
            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            
            frame.onload = function() {
                setupFrameCommunication();
                URL.revokeObjectURL(url);
            };
            
            frame.src = url;
        }

        function setupFrameCommunication() {
            window.addEventListener('message', function(event) {
                if (event.data.type === 'contentChanged') {
                    handleContentChange(event.data.element);
                } else if (event.data.type === 'elementHover') {
                    updateElementInspector(event.data.element);
                }
            });
        }

        function updateActiveCard(websiteId) {
            // Remove active class from all cards
            document.querySelectorAll('.website-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Add active class to selected card
            const targetCard = document.querySelector(`[data-website-id="${websiteId}"]`);
            if (targetCard) {
                targetCard.classList.add('active');
                console.log('Updated active card for:', websiteId);
            } else {
                console.warn('Card not found for website:', websiteId);
            }
        }

        function updateWebsiteSelector(websiteId) {
            const selector = document.getElementById('websiteSelector');
            if (selector) {
                selector.value = websiteId;
                console.log('Updated selector to:', websiteId);
            } else {
                console.warn('Website selector not found');
            }
        }

        function updateColorPalette(primaryColor) {
            const colorPalette = document.getElementById('colorPalette');
            if (!colorPalette) return;
            
            const colorScheme = generateColorScheme(primaryColor);
            
            colorPalette.innerHTML = '';
            
            Object.entries(colorScheme).forEach(([name, color]) => {
                if (name.includes('Color') || name === 'primary' || name === 'secondary' || name === 'accent') {
                    const swatch = document.createElement('div');
                    swatch.className = 'color-swatch';
                    swatch.style.backgroundColor = color;
                    swatch.title = name;
                    swatch.onclick = () => applyColor(name, color);
                    colorPalette.appendChild(swatch);
                }
            });
        }

        function initializeColorPalette() {
            const predefinedColors = [
                '#667eea', '#764ba2', '#f093fb', '#f5576c',
                '#26de81', '#fed330', '#45aaf2', '#a55eea',
                '#fd79a8', '#fdcb6e', '#6c5ce7', '#00b894'
            ];
            
            const colorPalette = document.getElementById('colorPalette');
            colorPalette.innerHTML = '';
            
            predefinedColors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.onclick = () => applyColor('primary', color);
                colorPalette.appendChild(swatch);
            });
        }

        function generateColorPalette() {
            const newColors = [];
            for (let i = 0; i < 12; i++) {
                const hue = Math.floor(Math.random() * 360);
                const saturation = 60 + Math.floor(Math.random() * 40);
                const lightness = 45 + Math.floor(Math.random() * 20);
                newColors.push(`hsl(${hue}, ${saturation}%, ${lightness}%)`);
            }
            
            const colorPalette = document.getElementById('colorPalette');
            colorPalette.innerHTML = '';
            
            newColors.forEach(color => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.onclick = () => applyColor('primary', color);
                colorPalette.appendChild(swatch);
            });
            
            showNotification('success', 'פלטת צבעים חדשה נוצרה!');
        }

        function applyColor(type, color) {
            if (!currentWebsite) {
                showNotification('warning', 'בחר אתר תחילה');
                return;
            }
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const root = frame.contentDocument.documentElement;
                root.style.setProperty(`--${type}`, color);
                
                // Update gradient if primary color changed
                if (type === 'primary') {
                    const colorScheme = generateColorScheme(color);
                    root.style.setProperty('--gradient-primary', 
                        `linear-gradient(135deg, ${color} 0%, ${colorScheme.secondary} 100%)`);
                }
            }
            
            addActivity(`צבע ${type} השתנה ל-${color}`);
            saveCurrentState();
        }

        // Revolutionary AI Functions
        function processAIRequest() {
            const input = document.getElementById('aiInput');
            const query = input.value.trim();
            
            if (!query) {
                showNotification('warning', 'הזן שאלה לעוזר AI');
                return;
            }
            
            if (!currentWebsite) {
                showNotification('warning', 'בחר אתר תחילה');
                return;
            }
            
            showNotification('info', 'עוזר AI עובד על השאלה...');
            
            // Simulate AI processing with advanced responses
            setTimeout(() => {
                const response = generateAIResponse(query);
                executeAICommand(response);
                input.value = '';
            }, 1500 + Math.random() * 1000);
        }

        function generateAIResponse(query) {
            const queryLower = query.toLowerCase();
            
            if (queryLower.includes('צבע') || queryLower.includes('color')) {
                return {
                    type: 'color_optimization',
                    message: 'מייעל את פלטת הצבעים לפי עקרונות עיצוב מתקדמים',
                    action: 'optimize_colors'
                };
            } else if (queryLower.includes('תוכן') || queryLower.includes('טקסט')) {
                return {
                    type: 'content_generation',
                    message: 'יוצר תוכן מותאם לתחום ולקהל היעד',
                    action: 'generate_content'
                };
            } else if (queryLower.includes('seo') || queryLower.includes('אופטימיזציה')) {
                return {
                    type: 'seo_optimization',
                    message: 'מבצע אופטימיזציה מתקדמת לקידום באינטרנט',
                    action: 'optimize_seo'
                };
            } else if (queryLower.includes('עיצוב') || queryLower.includes('לייאאוט')) {
                return {
                    type: 'design_optimization',
                    message: 'משפר את העיצוב לפי טרנדים עדכניים',
                    action: 'improve_design'
                };
            } else if (queryLower.includes('ביצועים') || queryLower.includes('מהירות')) {
                return {
                    type: 'performance_optimization',
                    message: 'מייעל את ביצועי האתר לטעינה מהירה',
                    action: 'optimize_performance'
                };
            } else {
                return {
                    type: 'general_advice',
                    message: 'הנה כמה הצעות לשיפור האתר שלך',
                    action: 'general_improvements'
                };
            }
        }

        function executeAICommand(response) {
            switch (response.action) {
                case 'optimize_colors':
                    runAICommand('color-harmony');
                    break;
                case 'generate_content':
                    runAICommand('generate-content');
                    break;
                case 'optimize_seo':
                    runAICommand('improve-seo');
                    break;
                case 'improve_design':
                    runAICommand('optimize-design');
                    break;
                case 'optimize_performance':
                    runPerformanceAudit();
                    break;
                default:
                    showGeneralImprovements();
            }
            
            showNotification('success', `עוזר AI: ${response.message}`);
            addActivity(`AI ביצע: ${response.message}`);
        }

        function runAICommand(command) {
            switch (command) {
                case 'optimize-design':
                    optimizeDesignWithAI();
                    break;
                case 'generate-content':
                    generateContentWithAI();
                    break;
                case 'improve-seo':
                    improveSEOWithAI();
                    break;
                case 'color-harmony':
                    optimizeColorsWithAI();
                    break;
            }
        }

        function optimizeDesignWithAI() {
            if (!currentWebsite) return;
            
            const improvements = [
                'שיפור מרווחים בין אלמנטים',
                'התאמת גדלי פונטים',
                'אופטימיזציה של צבעי רקע',
                'שיפור ניגודיות טקסט',
                'התאמת כפתורי פעולה'
            ];
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                // Apply design improvements
                const root = frame.contentDocument.documentElement;
                root.style.setProperty('--shadow', '0 15px 45px rgba(0,0,0,0.12)');
                root.style.setProperty('--transition', 'all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94)');
                
                // Improve button hover effects
                const buttons = frame.contentDocument.querySelectorAll('.cta-button, .submit-btn');
                buttons.forEach(btn => {
                    btn.style.transform = 'translateY(-2px)';
                    btn.style.boxShadow = '0 10px 30px rgba(0,0,0,0.15)';
                });
            }
            
            improvements.forEach((improvement, index) => {
                setTimeout(() => {
                    addActivity(`AI שיפר: ${improvement}`);
                }, index * 500);
            });
            
            showNotification('success', 'AI השלים אופטימיזציה מתקדמת לעיצוב!');
        }

        function generateContentWithAI() {
            if (!currentWebsite) return;
            
            const contentSuggestions = {
                'aesthetic-clinic': {
                    title: 'מרכז האסתטיקה המוביל בישראל',
                    description: 'טיפולי יופי מתקדמים עם טכנולוגיה חדשנית ומומחיות ברמה עולמית',
                    services: ['בוטוקס מתקדם', 'פילרים איכותיים', 'לייזר חדשני', 'טיפולי פנים', 'יעוץ אסתטי מקצועי']
                },
                'dr-michal-rosen': {
                    title: 'רפואה אסתטית ברמה עולמית',
                    description: 'מומחיות רפואית מובילה בטיפולי יופי וחידוש עם ליווי אישי מלא',
                    services: ['בוטוקס רפואי', 'מילוי קמטים', 'טיפולי הזרקה', 'יעוץ רפואי', 'טיפולים אישיים']
                }
                // Add more content for other websites
            };
            
            const suggestions = contentSuggestions[currentWebsite.id];
            if (suggestions) {
                const frame = document.getElementById('previewFrame');
                if (frame.contentDocument) {
                    // Update hero title
                    const heroTitle = frame.contentDocument.querySelector('.hero h1');
                    if (heroTitle) {
                        heroTitle.textContent = suggestions.title;
                    }
                    
                    // Update hero description
                    const heroDesc = frame.contentDocument.querySelector('.hero p');
                    if (heroDesc) {
                        heroDesc.textContent = suggestions.description;
                    }
                }
                
                addActivity('AI יצר תוכן מותאם לתחום העסק');
                showNotification('success', 'תוכן חדש נוצר בהצלחה על ידי AI!');
            }
        }

        function improveSEOWithAI() {
            if (!currentWebsite) return;
            
            const seoData = {
                title: `${currentWebsite.name} - ${currentWebsite.category} מקצועי | ${currentWebsite.features.slice(0, 3).join(', ')}`,
                description: `${currentWebsite.description}. שירותי ${currentWebsite.category} ברמה הגבוהה ביותר. ${currentWebsite.features.join(', ')}. צור קשר עוד היום!`,
                keywords: currentWebsite.features.join(', ') + `, ${currentWebsite.category}, ${currentWebsite.name}`
            };
            
            document.getElementById('seoTitle').value = seoData.title;
            document.getElementById('seoDescription').value = seoData.description;
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                let titleTag = frame.contentDocument.querySelector('title');
                if (titleTag) {
                    titleTag.textContent = seoData.title;
                }
                
                let metaDesc = frame.contentDocument.querySelector('meta[name="description"]');
                if (metaDesc) {
                    metaDesc.setAttribute('content', seoData.description);
                }
                
                let metaKeywords = frame.contentDocument.querySelector('meta[name="keywords"]');
                if (!metaKeywords) {
                    metaKeywords = frame.contentDocument.createElement('meta');
                    metaKeywords.setAttribute('name', 'keywords');
                    frame.contentDocument.head.appendChild(metaKeywords);
                }
                metaKeywords.setAttribute('content', seoData.keywords);
            }
            
            addActivity('AI ביצע אופטימיזציה מתקדמת לקידום באינטרנט');
            showNotification('success', 'אופטימיזציית SEO הושלמה בהצלחה!');
        }

        function optimizeColorsWithAI() {
            if (!currentWebsite) return;
            
            // Generate harmonious color palette based on current website
            const baseColor = currentWebsite.primaryColor;
            const harmonicColors = generateHarmonicColors(baseColor);
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const root = frame.contentDocument.documentElement;
                
                harmonicColors.forEach((color, index) => {
                    const property = ['--primary', '--secondary', '--accent'][index];
                    if (property) {
                        root.style.setProperty(property, color);
                    }
                });
                
                // Update gradient
                root.style.setProperty('--gradient-primary', 
                    `linear-gradient(135deg, ${harmonicColors[0]} 0%, ${harmonicColors[1]} 100%)`);
            }
            
            // Update color palette display
            updateColorPalette(harmonicColors[0]);
            
            addActivity('AI יצר פלטת צבעים הרמונית מתקדמת');
            showNotification('success', 'פלטת צבעים אופטימלית נוצרה על ידי AI!');
        }

        function generateHarmonicColors(baseColor) {
            const hsl = hexToHSL(baseColor);
            
            return [
                baseColor, // Primary
                HSLToHex((hsl.h + 30) % 360, Math.max(hsl.s - 10, 20), Math.max(hsl.l - 5, 30)), // Secondary
                HSLToHex((hsl.h + 180) % 360, hsl.s, Math.min(hsl.l + 10, 70)), // Complementary accent
                HSLToHex((hsl.h + 60) % 360, Math.min(hsl.s + 15, 100), hsl.l) // Triadic
            ];
        }

        // Advanced Device Management
        function setDevice(device) {
            currentDevice = device;
            
            const container = document.getElementById('iframeContainer');
            const buttons = document.querySelectorAll('.device-btn');
            
            // Update active button
            buttons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-device="${device}"]`).classList.add('active');
            
            // Update container class with smooth transition
            container.style.transition = 'all 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94)';
            container.className = `iframe-container device-${device}`;
            
            addActivity(`תצוגה שונתה ל-${device}`);
            
            // Add device-specific optimizations
            setTimeout(() => {
                const frame = document.getElementById('previewFrame');
                if (frame.contentDocument) {
                    const body = frame.contentDocument.body;
                    body.setAttribute('data-device', device);
                }
            }, 100);
        }

        function updateZoom(value) {
            const container = document.getElementById('iframeContainer');
            const zoomValue = document.getElementById('zoomValue');
            
            container.style.transform = `scale(${value / 100})`;
            container.style.transformOrigin = 'center top';
            zoomValue.textContent = `${value}%`;
            
            if (value !== 100) {
                container.style.marginBottom = `${(100 - value) * 3}px`;
            } else {
                container.style.marginBottom = '0';
            }
        }

        function refreshPreview() {
            if (!currentWebsite) {
                showNotification('warning', 'אין אתר לרענון');
                return;
            }
            
            const frame = document.getElementById('previewFrame');
            const currentSrc = frame.src;
            frame.src = 'about:blank';
            
            setTimeout(() => {
                frame.src = currentSrc;
                showNotification('success', 'התצוגה המקדימה רועננה');
            }, 100);
        }

        // Advanced Media Management
        function initializeMediaManager() {
            const uploadZone = document.getElementById('uploadZone');
            const fileInput = document.getElementById('fileInput');
            
            // Setup drag and drop
            uploadZone.addEventListener('click', () => fileInput.click());
            uploadZone.addEventListener('dragover', handleDragOver);
            uploadZone.addEventListener('dragleave', handleDragLeave);
            uploadZone.addEventListener('drop', handleDrop);
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // Load demo images
            loadDemoImages();
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('dragover');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('dragover');
            
            const files = Array.from(e.dataTransfer.files);
            processFiles(files);
        }

        function handleFileSelect(e) {
            const files = Array.from(e.target.files);
            processFiles(files);
        }

        function processFiles(files) {
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    uploadImage(file);
                } else {
                    showNotification('warning', `קובץ ${file.name} אינו תמונה תקינה`);
                }
            });
        }

        function uploadImage(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const imageData = {
                    id: Date.now() + Math.random(),
                    name: file.name,
                    src: e.target.result,
                    size: file.size,
                    type: file.type,
                    uploadTime: new Date()
                };
                
                mediaFiles.push(imageData);
                addImageToGallery(imageData);
                showNotification('success', `תמונה ${file.name} הועלתה בהצלחה`);
                addActivity(`הועלתה תמונה: ${file.name}`);
            };
            reader.readAsDataURL(file);
        }

        function addImageToGallery(imageData) {
            const mediaGrid = document.getElementById('mediaGrid');
            
            const mediaItem = document.createElement('div');
            mediaItem.className = 'media-item';
            mediaItem.innerHTML = `<img src="${imageData.src}" alt="${imageData.name}" loading="lazy">`;
            mediaItem.onclick = () => selectImage(imageData);
            
            mediaGrid.appendChild(mediaItem);
        }

        function loadDemoImages() {
            const demoImages = [
                'https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=200&h=200&fit=crop',
                'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=200&h=200&fit=crop',
                'https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=200&h=200&fit=crop',
                'https://images.unsplash.com/photo-1583394838336-acd977736f90?w=200&h=200&fit=crop'
            ];
            
            const mediaGrid = document.getElementById('mediaGrid');
            mediaGrid.innerHTML = '';
            
            demoImages.forEach((src, index) => {
                const mediaItem = document.createElement('div');
                mediaItem.className = 'media-item';
                mediaItem.innerHTML = `<img src="${src}" alt="תמונה ${index + 1}" loading="lazy">`;
                mediaItem.onclick = () => insertImageToWebsite(src);
                mediaGrid.appendChild(mediaItem);
            });
        }

        function selectImage(imageData) {
            showNotification('info', 'לחץ על מקום באתר להוספת התמונה');
            // Store selected image for insertion
            window.selectedImage = imageData;
        }

        function insertImageToWebsite(src) {
            showNotification('success', 'תמונה נבחרה - פיצ'ר זה יפותח בגרסה הבאה');
            addActivity('תמונה נבחרה להוספה לאתר');
        }

        function optimizeImages() {
            showNotification('info', 'מבצע אופטימיזציה לתמונות...');
            
            setTimeout(() => {
                const optimizedCount = mediaFiles.length;
                showNotification('success', `${optimizedCount} תמונות אופטמו בהצלחה!`);
                addActivity(`AI ביצע אופטימיזציה ל-${optimizedCount} תמונות`);
            }, 2000);
        }

        // Advanced Typography Management
        function updateTypography() {
            const fontFamily = document.getElementById('fontFamily').value;
            const frame = document.getElementById('previewFrame');
            
            if (frame.contentDocument) {
                frame.contentDocument.body.style.fontFamily = fontFamily;
                addActivity(`פונט שונה ל-${fontFamily}`);
                saveCurrentState();
            }
        }

        function updateFontSize(size) {
            document.getElementById('fontSizeValue').textContent = size + 'px';
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                frame.contentDocument.documentElement.style.setProperty('--base-font-size', size + 'px');
                addActivity(`גודל פונט שונה ל-${size}px`);
                saveCurrentState();
            }
        }

        function updateLineHeight(height) {
            document.getElementById('lineHeightValue').textContent = height;
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                frame.contentDocument.body.style.lineHeight = height;
                addActivity(`מרווח שורות שונה ל-${height}`);
                saveCurrentState();
            }
        }

        // Advanced Layout Management
        function addSmartSection(type) {
            if (!currentWebsite) {
                showNotification('warning', 'בחר אתר תחילה');
                return;
            }
            
            showNotification('info', `מוסיף סקציית ${type} חכמה...`);
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const newSection = createSmartSection(type);
                const contactSection = frame.contentDocument.querySelector('.contact');
                
                if (contactSection) {
                    contactSection.parentNode.insertBefore(newSection, contactSection);
                    addActivity(`נוספה סקציית ${type} חכמה`);
                    showNotification('success', `סקציית ${type} נוספה בהצלחה!`);
                    saveCurrentState();
                }
            }
        }

        function createSmartSection(type) {
            const section = document.createElement('section');
            section.className = type;
            section.style.cssText = `
                padding: 5rem 0;
                background: var(--surface);
                border-top: 1px solid var(--glass-border);
            `;
            
            const sectionTemplates = {
                'testimonials': `
                    <div class="container">
                        <h2 class="section-title" data-editable="true">המלצות לקוחות</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                            ${Array.from({length: 3}, (_, i) => `
                                <div style="background: white; padding: 2rem; border-radius: 15px; box-shadow: var(--shadow);">
                                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                        <div style="width: 50px; height: 50px; background: var(--gradient-primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700;">
                                            ${String.fromCharCode(65 + i)}
                                        </div>
                                        <div>
                                            <h4 data-editable="true">לקוח ${i + 1}</h4>
                                            <div style="color: var(--text-secondary); font-size: 0.9rem;" data-editable="true">לקוח מרוצה</div>
                                        </div>
                                    </div>
                                    <p data-editable="true">שירות מעולה ומקצועי ברמה הגבוהה ביותר. ממליץ בחום לכל מי שמחפש איכות וחדשנות.</p>
                                    <div style="color: var(--primary); margin-top: 1rem;">★★★★★</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `,
                'features': `
                    <div class="container">
                        <h2 class="section-title" data-editable="true">מה מייחד אותנו</h2>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 2rem;">
                            <div style="text-align: center; padding: 2rem;">
                                <i class="fas fa-award" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <h3 data-editable="true">מקצועיות מוכחת</h3>
                                <p data-editable="true">ניסיון רב שנים ומומחיות ברמה הגבוהה ביותר</p>
                            </div>
                            <div style="text-align: center; padding: 2rem;">
                                <i class="fas fa-clock" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <h3 data-editable="true">זמינות 24/7</h3>
                                <p data-editable="true">אנחנו כאן בשבילכם בכל עת, עם מענה מהיר ואמין</p>
                            </div>
                            <div style="text-align: center; padding: 2rem;">
                                <i class="fas fa-heart" style="font-size: 3rem; color: var(--primary); margin-bottom: 1rem;"></i>
                                <h3 data-editable="true">שירות אישי</h3>
                                <p data-editable="true">התאמה אישית לכל לקוח ולכל צורך ספציפי</p>
                            </div>
                        </div>
                    </div>
                `
            };
            
            section.innerHTML = sectionTemplates[type] || sectionTemplates['features'];
            return section;
        }

        function setSmartColumns(count) {
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                const grids = frame.contentDocument.querySelectorAll('.services-grid, .gallery-grid');
                grids.forEach(grid => {
                    if (count === 'auto') {
                        grid.style.gridTemplateColumns = 'repeat(auto-fit, minmax(300px, 1fr))';
                    } else {
                        grid.style.gridTemplateColumns = `repeat(${count}, 1fr)`;
                    }
                });
                
                addActivity(`פריסה שונתה ל-${count} עמודות`);
                saveCurrentState();
            }
        }

        function setElementStyle(style) {
            const frame = document.getElementById('previewFrame');
            if (!frame.contentDocument) return;
            
            const buttons = frame.contentDocument.querySelectorAll('.cta-button, .submit-btn');
            const cards = frame.contentDocument.querySelectorAll('.service-card, .gallery-item');
            
            switch(style) {
                case 'rounded':
                    [...buttons, ...cards].forEach(el => {
                        el.style.borderRadius = '25px';
                    });
                    break;
                case 'sharp':
                    [...buttons, ...cards].forEach(el => {
                        el.style.borderRadius = '4px';
                    });
                    break;
                case 'gradient':
                    buttons.forEach(btn => {
                        btn.style.background = 'var(--gradient-primary)';
                    });
                    break;
                case 'glass':
                    cards.forEach(card => {
                        card.style.background = 'rgba(255,255,255,0.1)';
                        card.style.backdropFilter = 'blur(20px)';
                        card.style.border = '1px solid rgba(255,255,255,0.2)';
                    });
                    break;
            }
            
            addActivity(`סגנון אלמנטים שונה ל-${style}`);
            saveCurrentState();
        }

        // Advanced Element Inspector
        function updateElementInspector(element) {
            const propertyGrid = document.getElementById('propertyGrid');
            const elementPath = document.getElementById('elementPath');
            
            if (element) {
                elementPath.textContent = element.selector || `${element.tag}.${element.className || 'element'}`;
                
                propertyGrid.innerHTML = `
                    <div class="property-group">
                        <div class="property-label">תוכן</div>
                        <textarea class="advanced-input" rows="2" onchange="updateElementContent(this.value)">${element.content || ''}</textarea>
                    </div>
                    
                    <div class="property-group">
                        <div class="property-label">סגנון טקסט</div>
                        <div class="button-group">
                            <button class="tool-btn" onclick="applyTextStyle('bold')" title="מודגש">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button class="tool-btn" onclick="applyTextStyle('italic')" title="נטוי">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button class="tool-btn" onclick="applyTextStyle('underline')" title="קו תחתון">
                                <i class="fas fa-underline"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="property-group">
                        <div class="property-label">צבע טקסט</div>
                        <input type="color" class="advanced-input" onchange="updateTextColor(this.value)">
                    </div>
                    
                    <div class="property-group">
                        <div class="property-label">גודל פונט</div>
                        <input type="range" class="slider" min="12" max="48" value="16" onchange="updateElementFontSize(this.value)">
                    </div>
                    
                    <div class="property-group">
                        <div class="property-label">מרווחים</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                            <input type="number" class="advanced-input" placeholder="Padding" onchange="updatePadding(this.value)">
                            <input type="number" class="advanced-input" placeholder="Margin" onchange="updateMargin(this.value)">
                        </div>
                    </div>
                `;
            } else {
                elementPath.textContent = 'בחר אלמנט לבדיקה...';
                propertyGrid.innerHTML = `
                    <div class="loading">
                        <span>בחר אלמנט לעריכה</span>
                        <div class="spinner"></div>
                    </div>
                `;
            }
        }

        function handleContentChange(element) {
            updateElementInspector(element);
            addActivity(`תוכן שונה: ${element.tag}`);
            saveCurrentState();
        }

        // Advanced Save & Export Functions
        function saveProject() {
            if (!currentWebsite) {
                showNotification('warning', 'אין פרויקט לשמירה');
                return;
            }
            
            isAISaving = true;
            document.querySelector('.status-indicator.saving').style.display = 'block';
            
            const projectData = {
                website: currentWebsite,
                timestamp: new Date().toISOString(),
                version: '3.0',
                mediaFiles: mediaFiles,
                customizations: getCustomizations()
            };
            
            // Simulate save process
            setTimeout(() => {
                localStorage.setItem(`webmaster_project_${currentWebsite.id}`, JSON.stringify(projectData));
                isAISaving = false;
                document.querySelector('.status-indicator.saving').style.display = 'none';
                showNotification('success', 'הפרויקט נשמר בהצלחה!');
                addActivity('הפרויקט נשמר בהצלחה');
            }, 1500);
        }

        function exportProject() {
            if (!currentWebsite) {
                showNotification('warning', 'אין פרויקט לייצוא');
                return;
            }
            
            const frame = document.getElementById('previewFrame');
            if (!frame.contentDocument) {
                showNotification('error', 'שגיאה בגישה לתוכן האתר');
                return;
            }
            
            showNotification('info', 'מכין קובץ HTML לייצוא...');
            
            setTimeout(() => {
                const htmlContent = frame.contentDocument.documentElement.outerHTML;
                const blob = new Blob([htmlContent], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${currentWebsite.id}_webmaster_pro.html`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                URL.revokeObjectURL(url);
                showNotification('success', 'אתר יוצא בהצלחה!');
                addActivity('האתר יוצא כקובץ HTML');
            }, 1000);
        }

        function getCustomizations() {
            const frame = document.getElementById('previewFrame');
            if (!frame.contentDocument) return {};
            
            const root = frame.contentDocument.documentElement;
            const computedStyles = window.getComputedStyle(root);
            
            return {
                colors: {
                    primary: root.style.getPropertyValue('--primary'),
                    secondary: root.style.getPropertyValue('--secondary'),
                    accent: root.style.getPropertyValue('--accent')
                },
                typography: {
                    fontFamily: frame.contentDocument.body.style.fontFamily,
                    fontSize: root.style.getPropertyValue('--base-font-size'),
                    lineHeight: frame.contentDocument.body.style.lineHeight
                },
                layout: {
                    device: currentDevice,
                    zoom: document.getElementById('zoomSlider').value
                }
            };
        }

        // Performance & Advanced Features
        function runPerformanceAudit() {
            showNotification('info', 'מבצע בדיקת ביצועים מתקדמת...');
            
            const metrics = {
                loadTime: Math.random() * 2 + 1,
                imageOptimization: Math.floor(Math.random() * 30) + 70,
                codeOptimization: Math.floor(Math.random() * 20) + 80,
                seoScore: Math.floor(Math.random() * 15) + 85
            };
            
            setTimeout(() => {
                const message = `
                    ביצועי האתר:
                    ⚡ זמן טעינה: ${metrics.loadTime.toFixed(1)}s
                    🖼️ אופטימיזציית תמונות: ${metrics.imageOptimization}%
                    💻 אופטימיזציית קוד: ${metrics.codeOptimization}%
                    🔍 ציון SEO: ${metrics.seoScore}%
                `;
                
                showNotification('success', 'בדיקת ביצועים הושלמה!');
                addActivity('בוצעה בדיקת ביצועים מתקדמת');
                
                // Show detailed results
                alert(message);
            }, 3000);
        }

        function optimizeForSpeed() {
            showNotification('info', 'מבצע אופטימיזציה לטעינה מהירה...');
            
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument) {
                // Add performance optimizations
                const images = frame.contentDocument.querySelectorAll('img');
                images.forEach(img => {
                    img.loading = 'lazy';
                    if (!img.alt) img.alt = 'תמונה';
                });
                
                // Add preload hints
                const head = frame.contentDocument.head;
                const preconnect = frame.contentDocument.createElement('link');
                preconnect.rel = 'preconnect';
                preconnect.href = 'https://fonts.googleapis.com';
                head.appendChild(preconnect);
            }
            
            setTimeout(() => {
                showNotification('success', 'אופטימיזציה לביצועים הושלמה!');
                addActivity('בוצעה אופטימיזציה מתקדמת לביצועים');
            }, 2000);
        }

        // Collaboration Features
        function inviteCollaborator() {
            const email = prompt('הזן כתובת מייל של המשתתף:');
            if (email && email.includes('@')) {
                const collaborator = {
                    id: Date.now(),
                    email: email,
                    name: email.split('@')[0],
                    joinTime: new Date(),
                    status: 'פעיל'
                };
                
                collaborators.push(collaborator);
                updateCollaboratorsList();
                showNotification('success', `הזמנה נשלחה ל-${email}`);
                addActivity(`הוזמן משתתף: ${email}`);
            }
        }

        function updateCollaboratorsList() {
            const userAvatars = document.getElementById('userAvatars');
            userAvatars.innerHTML = '<div class="user-avatar">אני</div>';
            
            collaborators.forEach(collab => {
                const avatar = document.createElement('div');
                avatar.className = 'user-avatar';
                avatar.textContent = collab.name.charAt(0).toUpperCase();
                avatar.title = collab.email;
                userAvatars.appendChild(avatar);
            });
        }

        // Activity Feed Management
        function addActivity(message) {
            const activityFeed = document.getElementById('activityFeed');
            const time = new Date().toLocaleTimeString('he-IL');
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <i class="fas fa-clock" style="margin-left: 0.5rem;"></i>
                ${time} - ${message}
            `;
            
            activityFeed.insertBefore(activityItem, activityFeed.firstChild);
            
            // Keep only last 10 activities
            while (activityFeed.children.length > 10) {
                activityFeed.removeChild(activityFeed.lastChild);
            }
        }

        // Advanced Settings Functions
        function generateSEO() {
            if (!currentWebsite) {
                showNotification('warning', 'בחר אתר תחילה');
                return;
            }
            
            improveSEOWithAI();
        }

        function toggleAnimations() {
            const enabled = document.getElementById('enableAnimations').checked;
            const frame = document.getElementById('previewFrame');
            
            if (frame.contentDocument) {
                const root = frame.contentDocument.documentElement;
                root.style.setProperty('--transition', enabled ? 'all 0.3s ease' : 'none');
                
                addActivity(`אנימציות ${enabled ? 'הופעלו' : 'כובו'}`);
            }
        }

        function toggleParallax() {
            const enabled = document.getElementById('enableParallax').checked;
            addActivity(`אפקט Parallax ${enabled ? 'הופעל' : 'כובה'}`);
            showNotification('info', 'אפקט Parallax יופעל בגרסה הבאה');
        }

        function toggleMicroInteractions() {
            const enabled = document.getElementById('enableMicroInteractions').checked;
            const frame = document.getElementById('previewFrame');
            
            if (frame.contentDocument) {
                const elements = frame.contentDocument.querySelectorAll('.cta-button, .service-card');
                elements.forEach(el => {
                    if (enabled) {
                        el.style.transform = 'scale(1)';
                        el.style.transition = 'transform 0.2s ease';
                    } else {
                        el.style.transform = 'none';
                        el.style.transition = 'none';
                    }
                });
                
                addActivity(`מיקרו אינטראקציות ${enabled ? 'הופעלו' : 'כובו'}`);
            }
        }

        // State Management
        function saveCurrentState() {
            if (!currentWebsite) return;
            
            const state = {
                website: currentWebsite,
                customizations: getCustomizations(),
                timestamp: Date.now()
            };
            
            undoStack.push(state);
            redoStack = []; // Clear redo stack
            
            // Limit undo stack to 50 items
            if (undoStack.length > 50) {
                undoStack.shift();
            }
        }

        function loadSavedState() {
            // Load last worked project
            const lastProject = localStorage.getItem('webmaster_last_project');
            if (lastProject) {
                try {
                    const projectData = JSON.parse(lastProject);
                    if (projectData.website && websiteDatabase[projectData.website.id]) {
                        loadWebsite(websiteDatabase[projectData.website.id]);
                    }
                } catch (e) {
                    console.log('Could not load last project');
                }
            }
        }

        // Real-time Features
        function startRealTimeFeatures() {
            // Auto-save every 30 seconds
            setInterval(() => {
                if (currentWebsite && !isAISaving) {
                    saveProject();
                }
            }, 30000);
            
            // Update time every second
            setInterval(updateTime, 1000);
            
            // Periodic activity updates
            setInterval(() => {
                if (Math.random() < 0.1) { // 10% chance
                    addActivity('מערכת פעילה ומעודכנת');
                }
            }, 60000);
        }

        function setupAdvancedEventListeners() {
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey || e.metaKey) {
                    switch(e.key) {
                        case 's':
                            e.preventDefault();
                            saveProject();
                            break;
                        case 'e':
                            e.preventDefault();
                            exportProject();
                            break;
                        case 'r':
                            e.preventDefault();
                            refreshPreview();
                            break;
                    }
                }
            });
            
            // Window resize handler
            window.addEventListener('resize', function() {
                updateZoom(document.getElementById('zoomSlider').value);
            });
        }

        // Utility Functions
        function hexToHSL(hex) {
            const r = parseInt(hex.slice(1, 3), 16) / 255;
            const g = parseInt(hex.slice(3, 5), 16) / 255;
            const b = parseInt(hex.slice(5, 7), 16) / 255;
            
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;
            
            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = (g - b) / d + (g < b ? 6 : 0); break;
                    case g: h = (b - r) / d + 2; break;
                    case b: h = (r - g) / d + 4; break;
                }
                h /= 6;
            }
            
            return {
                h: Math.round(h * 360),
                s: Math.round(s * 100),
                l: Math.round(l * 100)
            };
        }

        function HSLToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function updateTime() {
            const now = new Date();
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('he-IL');
        }

        function showNotification(type, message) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.5rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 4000);
        }

        function loadDemoWebsite() {
            console.log('🚀 Loading demo website...');
            
            // Load first available website as demo
            const demoWebsite = Object.values(websiteDatabase)[0];
            if (demoWebsite) {
                console.log('📱 Demo website selected:', demoWebsite.name);
                loadWebsite(demoWebsite);
            } else {
                console.error('❌ No websites available for demo');
                showNotification('error', 'אין אתרים זמינים לדמו');
            }
        }

        function testWebsiteConnection() {
            console.log('🔬 Testing website connection...');
            
            // Test if websiteDatabase is populated
            console.log('📊 Available websites:', Object.keys(websiteDatabase).length);
            console.log('📋 Website list:', Object.keys(websiteDatabase));
            
            // Test if elements exist
            const criticalElements = ['websiteGrid', 'websiteSelector', 'previewFrame'];
            criticalElements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`🔍 Element ${id}:`, element ? '✅ Found' : '❌ Missing');
            });
            
            // Test generateAdvancedWebsiteHTML
            if (Object.keys(websiteDatabase).length > 0) {
                const testWebsite = Object.values(websiteDatabase)[0];
                try {
                    const html = generateAdvancedWebsiteHTML(testWebsite);
                    console.log('🎨 HTML generation test:', html.length > 1000 ? '✅ Success' : '❌ Failed');
                } catch (error) {
                    console.error('❌ HTML generation failed:', error);
                }
            }
        }

        function showWelcomeNotification() {
            setTimeout(() => {
                showNotification('success', 'WebMaster Pro 3.0 הותחל בהצלחה! 🚀');
                
                setTimeout(() => {
                    showNotification('info', 'לחץ על "דמו מהיר" או בחר אתר מהגלריה כדי להתחיל עריכה');
                }, 2000);
                
                // Run connection test
                setTimeout(() => {
                    testWebsiteConnection();
                }, 3000);
            }, 1000);
        }

        function togglePreview() {
            const frame = document.getElementById('previewFrame');
            if (frame.src !== 'about:blank') {
                const newWindow = window.open();
                newWindow.document.write(frame.contentDocument.documentElement.outerHTML);
                newWindow.document.close();
                showNotification('success', 'תצוגה מקדימה נפתחה בחלון חדש');
            } else {
                showNotification('warning', 'אין אתר לתצוגה מקדימה');
            }
        }

        function showGeneralImprovements() {
            const improvements = [
                'שיפור מהירות טעינה',
                'אופטימיזציה לנגישות',
                'שיפור SEO אוטומטי',
                'התאמה למובייל',
                'אופטימיזציית תמונות'
            ];
            
            improvements.forEach((improvement, index) => {
                setTimeout(() => {
                    addActivity(`המלצת AI: ${improvement}`);
                }, index * 1000);
            });
            
            showNotification('success', 'AI סיפק המלצות לשיפור האתר');
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                addActivity('WebMaster Pro 3.0 אותחל בהצלחה');
                addActivity('11 אתרים מקצועיים מוכנים לעריכה');
                addActivity('עוזר AI פעיל ומוכן לעזרה');
            }, 500);
        });

        // Mobile responsiveness
        function toggleMobileSidebar(side) {
            const sidebar = document.querySelector(`.${side}-sidebar`);
            sidebar.classList.toggle('mobile-open');
        }

        // Add mobile menu buttons if needed
        if (window.innerWidth <= 768) {
            const mobileToggle = document.createElement('button');
            mobileToggle.innerHTML = '<i class="fas fa-bars"></i>';
            mobileToggle.className = 'action-btn';
            mobileToggle.onclick = () => toggleMobileSidebar('left');
            document.querySelector('.header-actions').insertBefore(mobileToggle, document.querySelector('.header-actions').firstChild);
        }

        function updateElementContent(content) {
            if (selectedElement) {
                selectedElement.textContent = content;
                addActivity(`תוכן עודכן: ${content.substring(0, 30)}...`);
                saveCurrentState();
            }
        }

        function applyTextStyle(style) {
            const frame = document.getElementById('previewFrame');
            if (frame.contentDocument && selectedElement) {
                switch(style) {
                    case 'bold':
                        selectedElement.style.fontWeight = selectedElement.style.fontWeight === 'bold' ? 'normal' : 'bold';
                        break;
                    case 'italic':
                        selectedElement.style.fontStyle = selectedElement.style.fontStyle === 'italic' ? 'normal' : 'italic';
                        break;
                    case 'underline':
                        selectedElement.style.textDecoration = selectedElement.style.textDecoration === 'underline' ? 'none' : 'underline';
                        break;
                }
                addActivity(`סגנון טקסט שונה: ${style}`);
                saveCurrentState();
            }
        }

        function updateTextColor(color) {
            if (selectedElement) {
                selectedElement.style.color = color;
                addActivity(`צבע טקסט שונה ל-${color}`);
                saveCurrentState();
            }
        }

        function updateElementFontSize(size) {
            if (selectedElement) {
                selectedElement.style.fontSize = size + 'px';
                addActivity(`גודל פונט שונה ל-${size}px`);
                saveCurrentState();
            }
        }

        function updatePadding(value) {
            if (selectedElement) {
                selectedElement.style.padding = value + 'px';
                addActivity(`Padding שונה ל-${value}px`);
                saveCurrentState();
            }
        }

        // Error handling wrapper
        function safeExecute(func, ...args) {
            try {
                return func(...args);
            } catch (error) {
                console.error('Error executing function:', error);
                showNotification('error', 'שגיאה: ' + error.message);
                return null;
            }
        }

        // Wrap all functions with error handling
        const originalFunctions = {};
        const functionNames = [
            'loadWebsite', 'processAIRequest', 'saveProject', 'exportProject',
            'generateColorPalette', 'setDevice', 'updateZoom', 'refreshPreview'
        ];

        functionNames.forEach(name => {
            if (window[name]) {
                originalFunctions[name] = window[name];
                window[name] = function(...args) {
                    return safeExecute(originalFunctions[name], ...args);
                };
            }
        });

        // Missing global functions that are called from HTML
        window.togglePreview = togglePreview;
        window.saveProject = saveProject;
        window.exportProject = exportProject;
        window.processAIRequest = processAIRequest;
        window.runAICommand = runAICommand;
        window.generateColorPalette = generateColorPalette;
        window.updateTypography = updateTypography;
        window.updateFontSize = updateFontSize;
        window.updateLineHeight = updateLineHeight;
        window.setElementStyle = setElementStyle;
        window.addSmartSection = addSmartSection;
        window.setSmartColumns = setSmartColumns;
        window.setDevice = setDevice;
        window.updateZoom = updateZoom;
        window.refreshPreview = refreshPreview;
        window.optimizeImages = optimizeImages;
        window.inviteCollaborator = inviteCollaborator;
        window.generateSEO = generateSEO;
        window.toggleAnimations = toggleAnimations;
        window.toggleParallax = toggleParallax;
        window.toggleMicroInteractions = toggleMicroInteractions;
        window.runPerformanceAudit = runPerformanceAudit;
        window.optimizeForSpeed = optimizeForSpeed;
        window.updateElementContent = updateElementContent;
        window.applyTextStyle = applyTextStyle;
        window.updateTextColor = updateTextColor;
        window.updateElementFontSize = updateElementFontSize;
        window.updatePadding = updatePadding;
        window.updateMargin = updateMargin;
        window.loadDemoWebsite = loadDemoWebsite;
        window.testWebsiteConnection = testWebsiteConnection;

        // Validation function to check all critical elements exist
        function validateEditorState() {
            const criticalElements = [
                'websiteGrid', 'websiteSelector', 'colorPalette', 
                'previewFrame', 'aiInput', 'uploadZone'
            ];
            
            const missing = criticalElements.filter(id => !document.getElementById(id));
            if (missing.length > 0) {
                console.warn('Missing elements:', missing);
                return false;
            }
            return true;
        }

        // Global error handler
        window.addEventListener('error', function(event) {
            console.error('Global error caught:', event.error);
            showNotification('error', 'שגיאה במערכת - המערכת ממשיכה לפעול');
            return true; // Prevent default error handling
        });

        // Unhandled promise rejection handler
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            showNotification('warning', 'בעיה קלה במערכת - המערכת ממשיכה לפעול');
            event.preventDefault();
        });

        // Final initialization check
        console.log('WebMaster Pro 3.0 - Successfully Loaded!');
        console.log('Available websites:', Object.keys(websiteDatabase).length);
        console.log('All systems operational');

    </script>
</body>
</html>
